{"type":"answer","id":201013,"parentType":"question","parentId":20551,"uid":18160,"contents":"我觉得你们吓到楼主了。。。<br>\n<br>\n我给个思路，不说具体的<br>\n首先，我翻墙的主要用途是<b>浏览器</b>。那么浏览器如何翻墙呢？设置代理！<br>\n第二个问题，浏览器支持哪些代理方式？<b>socks5 和 http代理</b>！而且http代理优先，因为socks5代理很多软件不支持。而且windows默认只能http代理，不支持socks5.<br>\n既然浏览器默认不支持自定义的代理协议，为什么我们要去研发自己的协议呢？<br>\n第三个问题，为什么把代理地址为什么是127.0.0.1 这样的本地地址，而不是直接填写远程服务器地址？<br>\n关键来了：因为不论是http代理还是socks5代理，都是明文。。。<br>\n如果是http代理，每次都要发CONNECT请求【类似POST和GET】<br>\nsocks5也是一样的，参考RFC文档<br>\n所以部署在本地，然后由<b>客户端加密</b>以后发给远程服务器。<br>\n第四个问题，客户端和服务端通信，<b>为什么要走https</b>？<br>\n实际上，<b>我觉得不需要</b>，因为协议其实跑在TLS上，对于第三方而言，它完全没法知道这个是https<br>\nhttps交互过程<br>\n客户端 和 服务端 建立 TCP连接<br>\n客户端 和 服务端 建立 TLS连接<br>\n客户端 和 服务端 开始HTTP报文<br>\n---------------------------------------------------<br>\n所以，对于第三方来讲只能看到这里在TLS通信，<b>看不到TLS里的内容，自然也就没法知道是https协议了</b><br>\n<br>\n第五个问题，既然为了保密一定要用TLS，我该学习什么呢？<br>\n不要学习这么多，为难你自己。你只要下载一个openssl或者boringssl，<br>\n<b>学习ssl_connect,ssl_accept,ssl_write,ssl_read 四个api就可以了。。。</b><br>\n包教包会，别无聊去看源码。看下上面四个api的demo，足以学会TLS使用了！！！<br>\n<br>\n第六个问题，说了这么多，翻墙软件怎么写呢？<br>\n翻墙过程如下<br>\n你的浏览器 ---socks代理---&gt; 翻墙客户端---tls---&gt; 翻墙服务端 ---&gt; 你的目标网站<br>\n<br>\n正常人应该发现我们要做的是什么了，对，实现 socks5 over TLS！<br>\n网上搜索 socks5 over TLS，刚好发现了一堆开源项目！随便学习，你想学什么语言都可以了。。。<br>\n翻墙客户端，功能就是<b>把socks5协议转成TLS或基于TLS的协议【比如https】</b>，做了一个协议中转的功能。【自己读了下，发现不严谨，但是大概意思没错了】<br>\n翻墙服务端，功能就是代理了。发收到的代理请求转发实现。<br>\n压根用不到libuv，libev这些。更加不可能去hook 系统的socket，写内核，写驱动。。。<br>\n写机场是另外一回事了<br>\n也不用学习红黑树，内存分页。。。纯无聊，<b>我们是造轮子，不是造钉子</b>！<br>\n<br>\n第七个问题，PAC又是什么东西？<br>\nPAC是一个配置文件，告诉浏览器，那些需要走代理，哪些不需要走代理。。。<br>\n<b>完全跑在浏览器或者客户端上</b>，服务端是不需要走PAC的！<br>\n这个问题有点复杂，你就当不知道pac的存在吧。也就是都走代理模式。。。。<br>\n没有安全意识的人，不要不配置pac！<br>\n没有安全意识的人，不要不配置pac！<br>\n没有安全意识的人，不要不配置pac！<br>\n<br>\n第八个问题，为什么我写的翻墙软件会被封掉？<br>\n浏览器访问一个网站，比如www.google.com，需要先向DNS询问IP地址<br>\nDNS查询是明文的！<br>\n封掉你的逻辑是这样的<br>\n1.你翻墙以后，浏览器浏览google，浏览器不认识google，所以向dns查ip地址<br>\n2.共产党截获了你的电脑的请求，给了一个不存在的ip，6.6.6.6<br>\n3.你的浏览器告诉 你的翻墙软件，说你要访问6.6.6.6<br>\n4.翻墙软件把你的请求，转发给了6.6.6.6，然后你就上不了网！<br>\n<br>\n解决办法，你必须保证自己的DNS是安全的！<br>\n也就是DNS over TLS，或者DNS over HTTPS<br>\n第九个问题，如何配置DNS 为 DNS over TLS？<br>\n去https://developers.cloudflare.com/1.1.1.1/dns-over-https/cloudflared-proxy/<br>\n根据教程，配置cloudflared<br>\n<br>\n然后把DNS地址设置成127.0.0.1，你就安全了！！！","date":"2020-03-10","agreeCount":10,"discussionCount":1}