{"type":"article_comment","id":301655,"parentType":"article","parentId":5850,"uid":25544,"contents":"上次说过的零赞导致声望降低，不久前听说又回来了，我后来想到，其实还有一种方法解决因为取消扣除的声望大于点赞导致的负数，就是多保存一项资料。<br>\n<br>\n当前点赞和取消都是以当下的被投票的内容字数、投票者的声望及投票者七天内的投票数来实时计算，但是，可以选择在被投票者的fields<br>\n@param string $type&nbsp; &nbsp; //被投票内容类型<br>\n@param int $item_id&nbsp; &nbsp; //被投票内容ID<br>\n之外在数据库里加多一个field来储存被收到的声望，例如<br>\n@param float $reputation_voted&nbsp; &nbsp; //被投票内容收到的声望<br>\n这样，如果这个field没数据才实时计算，在影响声望后将计算出来的影响声望储存到那个field里面。若已投票过而且当前的vote_value不是零，则不实时计算，（若check_reputation_type里面没有的，return false，可能会导致没法去加回已扣除的声望，看要怎么设计吧）改成在被投票用户的声望里扣除这个field的数值，然后field的数值归零。<br>\n<br>\n缺点是，如果之前的点赞和反对的时间差了很久，现在投票的用户的声望已经高了或低了很多，或者被投票内容被编辑过，加了很多或扣除了很多字数，已保存的被投票时被影响的声望会与依当下参数实时计算的要影响的声望有一定的差距。<br>\n<br>\n优点是，被投回去0赞时，声望加或减刚刚好归零，不多也不少。","date":"2020-03-18","agreeCount":0,"discussionCount":0}