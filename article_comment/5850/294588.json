{"type":"article_comment","id":294588,"parentType":"article","parentId":5850,"uid":18160,"contents":"迷雾通代码笔记<br>\n<br>\n申明：我不是专业人士，有错误，你们及时提醒我！<br>\n<br>\n迷雾通官方代码路径<br>\nhttps://github.com/geph-official/geph2<br>\n<br>\n目前进度，我在读https://github.com/geph-official/geph2/blob/master/cmd/geph-client/main.go<br>\nfunc main()这个函数，sWrap = newSmuxWrapper() 重点看这个<br>\nlistenHTTP 启动http代理<br>\nlistenSocks 启动socks代理<br>\n<br>\nhttps://github.com/geph-official/geph2/blob/master/cmd/geph-client/getmux.go<br>\nfunc newSmuxWrapper()<br>\ngetDirect/getSingleHop 重点看下这两个函数<br>\n<br>\n<br>\nhttps://github.com/geph-official/geph2/blob/master/cmd/geph-client/methods.go<br>\ngetDirect函数里，这里区分了TCP和UDP<br>\n1.conn, err = niaucchi4.DialKCP(host+\":2389\", make([]byte, 32))&nbsp; &nbsp; &nbsp; &nbsp; 重点看下这个函数<br>\n2.ss, err = negotiateSmux(&amp;greeting, conn, pk)&nbsp; &nbsp; &nbsp; &nbsp; 重点看下这个函数<br>\n<br>\n我更关心niaucchi4，我觉得这个是协议关键信息<br>\nhttps://github.com/geph-official/geph2/tree/master/libs/niaucchi4<br>\n<br>\n代码在https://github.com/geph-official/geph2/blob/master/libs/niaucchi4/listener.go<br>\n慢慢研究。。。<br>\nhttps://github.com/geph-official/geph2/blob/master/libs/niaucchi4/tunnel.go<br>\n<br>\n代码量真大啊，一个人写的话，得写好久吧。。。<br>\nhttps://github.com/geph-official/geph2/tree/master/libs/tinyss<br>\n感觉从这里看起，容易点<br>\n貌似代码加密只有chacha20-poly1305<br>\n没支持AES128-gcm或者AES256-GCM<br>\n<br>\n<br>\n代码貌似区分TCP和UDP<br>\n看的一头雾水，改天继续研究<br>\n<br>\n<br>\n==================update1==================<br>\n第一步，binder race 不知道是什么<br>\n第二步，DNS 9983干嘛的<br>\n第三步，[https://ajax.aspnetcdn.com/v2 ， gephbinder.azureedge.net] won binder race<br>\ntor 也是在 azureedge.net，比如meek， meek.azureedge.net<br>\n第四步，must use bridges Obtained 3 bridges<br>\n139.*.*.*:446** <br>\n149.*.*.*:608**<br>\n167.*.*.*:330**<br>\n第五步，NON-LEGACY e2e!<br>\n第六步，adding ephemeral 139.*.*.*:446** to our e2e<br>\n第七步，Successfully got external IP *****<br>\n<br>\n默认useTCP = false","date":"2020-03-12","agreeCount":3,"discussionCount":0}