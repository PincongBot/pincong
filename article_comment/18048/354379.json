{"type":"article_comment","id":354379,"parentType":"article","parentId":18048,"uid":18160,"contents":"第五部分：也是今天最后的内容了。。。<br>\n因为我们<b>只关心</b>翻墙！所以我们的重点，是客户端<b>如何到达网桥</b>！<br>\n现在开始讲解：<br>\n1. 客户端调用 dialBridge，得到一个tcp连接，再调用cshirt2.Client(cookie, conn)<br>\n2.cshirt2 库 调用 dhGenKey() 生成密钥对，明文发送自己的公钥给服务端<br>\n3.服务端 明文发送网桥的公钥，调用 udhSecret函数，得到 chacha的密钥<br>\n4.返回 transport ，作为入参调用 connThroughBridge<br>\n5.向网桥发送 cmd【conn/feedback】和 exitName【us-sfo-01.exits.geph.io】<br>\n6.读取网桥的应答，收到表示没问题，将这个transport放到sessionMap里<br>\n<br>\n=========================================<br>\n现在将socks5代理部分：<br>\n1.客户端收到 socks5请求以后 调用 remote, ok = sWrap.DialCmd(\"proxy\", rmAddr)<br>\n2.从刚才的sessionMap拿出一个连接，发送 cmd【proxy 地址】，成功以后就是一次link了~<br>\n3.网桥这个tcp连接已经和exit节点做了link，所以直接转发给了exit节点<br>\n4.查看出口节点代码 cmd\\geph-exit\\handle.go ,搜索 <br>\n<pre>case \"proxy\":</pre><br>\n<br>\n然后自己读就好了，我觉得不难。。。<br>\n没有任何算法部分，单纯就是根据域名解析ip，然后判断是不是在黑名单，没问题就去直连，建立link<br>\n<br>\n<br>\n我觉得，exit节点没有任何我感兴趣的部分。。。没怎么读。。。<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n<br>\n我在品葱的大总结~<br>\nShadowSocks 就是 socks5 over AES<br>\n迷雾通 就是 socks5 over Chacha20<br>\nv2ray 网上主流 方式&nbsp; vmess over WSS【websocket over TLS】<br>\n沉默的广场提供的v2ray方式&nbsp; socks5 over WSS【websocket over TLS】<br>\nTor的meek网桥 就是 socks5 over https【http over TLS】<br>\nlantern&nbsp;&nbsp;&nbsp; 这个是lampshade协议，纯私有 ，但是代码完全开源？？？<br>\n<br>\n另外大家都用到CDN，除了v2ray用了CDN的反向代理<br>\n还提供了很多静态资源下载方式<br>\n这里列举下lantern的地址<br>\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;http://config.getiantem.org/proxies.yaml.gz<br>\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;http://d2wi0vwulmtn99.cloudfront.net/proxies.yaml.gz<br>\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;http://config-staging.getiantem.org/proxies.yaml.gz<br>\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;http://d33pfmbpauhmvd.cloudfront.net/proxies.yaml.gz<br>\n<br>\n这里列举下tor的meek<br>\nhttps://meek.azureedge.net/<br>\n<br>\n这里列举下迷雾通的<br>\nhttp://1680337695.rsc.cdn77.org<br>\nhttp://loving-bell-981479.netlify.com<br>\nhttp://gephbinder-vzn.azureedge.net<br>\n<br>\n<br>\n最后，再次感谢 @为啥改名还要葱 赠送的1600 葱！！！<br>\n希望更多人给我送葱~<br>\n我会写感谢列表，每个人都可以得到感谢~","date":"2020-04-22","agreeCount":13,"discussionCount":0}