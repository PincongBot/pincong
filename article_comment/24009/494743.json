{"type":"article_comment","id":494743,"parentType":"article","parentId":24009,"uid":36432,"contents":"来点不同的声音吧。纯搬运，我不是程序员，别来杠我。<br>\n<br>\n作者：Calvin<br>\n链接：https://www.zhihu.com/question/420506693/answer/1466076213<br>\n来源：知乎<br>\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。<br>\n<br>\n首先虽然hap安装包中有apk安装包，但这并不是说鸿蒙是安卓套壳，从前面我的分析可以看出，apk包中是不包含任何软件逻辑的，这个包似乎是自动生成的，并且即使创建新的工程再编译，除了java的包名以外也基本上都不会变的。原回答的图中可以看出，apk的代码包含两个类：MainAbilityShellActivity和ShellMyApplication。shell是壳的意思，例如Linux的shell就是指在内核上套了一层壳，用户在终端通过这层壳与内核交互，从类名可以大致判断，这里的Activity是作为鸿蒙的Ability的一层壳，猜测是用来实现安卓进程与鸿蒙进程通讯。可以先看一下AbilityShellActivity的源代码：<br>\n<br>\nAbilityShellActivity<br>\n这里的代码也正是引起大家争议的地方，因为他import了安卓的api，继承自安卓的Activity，不过这里import大多数都是与上下文有关的类，可以看到这个类还实现了一个接口IAbilityShell，查看其源代码：<br>\n<br>\nIAbilityShell<br>\n这个接口用来获取系统的上下文、获取系统类加载器、设置UI，也就是说这个Activity会与相应的Ability绑定，通过这个接口在安卓进程中可以获取到鸿蒙Ability相应的上下文信息，实现进程间的ipc。同样看一下HarmonyApplication这个类：<br>\n<br>\n<br>\n该类继承自安卓的Application，作为一个安卓进程的实体类。该类有get、set Ability等方法来获取、设置所对应鸿蒙进程的ability。<br>\n<br>\n如果分析的没错，这个apk就是用来实现鸿蒙进程与安卓进程通信的，HarmonyApplication中的最后一段代码也能说明这点<br>\n<br>\n<br>\n可以看到这个类初始化是会加载ipc_core.z这个so库，从名字就可判断是用于进程间ipc的。","date":"2020-09-13","agreeCount":0,"discussionCount":0}