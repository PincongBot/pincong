{"type":"article_comment","id":12760,"parentType":"article","parentId":1468,"uid":920,"contents":"不需要网站后台进行变更。<br>\n<br>\n<pre><br>\n// ==UserScript==<br>\n// @name        PincongArchive<br>\n// @namespace   PincongArchive<br>\n// @match       https://pincong.rocks/article/*<br>\n// @version     1<br>\n// @grant       none<br>\n// @run-at      document-end<br>\n// ==/UserScript==<br>\n<br>\n(function(){<br>\n    let doc=document;<br>\n    let newtag=function(t){return doc.createElement(t);}<br>\n    let newtext=function(s){return doc.createTextNode(s);}<br>\n    let selid=function(i){return doc.getElementById(i);}<br>\n    let selcss1=function(c,r){return (r?r:doc).querySelector(c);}<br>\n    let appendnode=function(r,n){n?r.appendChild(n):null;}<br>\n<br>\n    let archive='https://web.archive.org/';<br>\n<br>\n    let checkavl=function(url){<br>\n        let req=new Request(archive+'wayback/available?url='+url,<br>\n                            {'method':'GET','redirect':'error'});<br>\n        fetch(req).then(function(resp){<br>\n            return resp.json();<br>\n        }).then(function(data){<br>\n            let con=selid('PincongArchive-counter');<br>\n            let a=selid('PincongArchive-link');<br>\n            let c=data['archived_snapshots']['closest'];<br>\n            if(c){<br>\n                a.href=c['url'];<br>\n                con.textContent='archived at '+c['timestamp'];<br>\n            }else{<br>\n                a.href=archive+'save/'+url;<br>\n                con.textContent='not archived';<br>\n            }<br>\n        })<br>\n    }<br>\n<br>\n    let createui=function(){<br>\n        let parent=selcss1('nav&gt;ul.nav');<br>\n        if(!parent)return;<br>\n<br>\n        let url=location.href;<br>\n        let root=newtag('li');<br>\n        let a=newtag('a');<br>\n        let con=newtag('span');<br>\n        appendnode(parent,root);<br>\n        appendnode(root,a);<br>\n        appendnode(a,newtext('PincongArchive'));<br>\n        appendnode(a,con);<br>\n        appendnode(con,newtext('checking...'));<br>\n<br>\n        a.id='PincongArchive-link';<br>\n        con.id='PincongArchive-counter';<br>\n    }<br>\n<br>\n    createui();<br>\n})()<br>\n</pre>","date":"2019-05-06","agreeCount":0,"discussionCount":0}