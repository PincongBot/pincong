{"type":"article_comment","id":249385,"parentType":"article","parentId":5489,"uid":14455,"contents":"正常时，速度不错，稳定性也可以。 但不正常情况更多。<br>\n<br>\n<br>\nWireGuard配置过程<br>\n<br>\n# gcp VPS安装WireGuard<br>\n<br>\n选择 Ubuntu 18.04 LTS&nbsp; 系统<br>\n<br>\nadd-apt-repository ppa:wireguard/wireguard<br>\napt-get update<br>\n#####apt-get install wireguard-dkms wireguard-tools resolvconf -y<br>\napt-get install wireguard resolvconf -y<br>\n<br>\n<br>\n<br>\n# 开启ipv4 ipv6流量转发<br>\necho \"net.ipv4.ip_forward = 1\" &gt;&gt; /etc/sysctl.conf<br>\necho \"net.ipv6.conf.all.forwarding = 1\" &gt;&gt; /etc/sysctl.conf<br>\necho \"net.ipv6.conf.default.accept_ra=2\" &gt;&gt; /etc/sysctl.conf<br>\nsysctl -p<br>\n<br>\n<br>\n<br>\n# 创建并进入WireGuard文件夹<br>\nchmod 0777 /etc/wireguard<br>\ncd /etc/wireguard<br>\numask 077<br>\n<br>\n<br>\n# 生成服务器和客户端密钥对<br>\nwg genkey | tee spri | wg pubkey &gt; spub<br>\nwg genkey | tee cpri | wg pubkey &gt; cpub<br>\nwg genpsk &gt;PSK<br>\n<br>\n<br>\n<br>\n服务端配置文件<br>\n<br>\n创建并进入了 WireGuard 后，开始配置服务端文件，输入ifconfig查看主网卡名称，记住以上标记处名字，若不是eth0，可以将其复制了待会需要用到。<br>\n<br>\n<br>\n生成服务器配置文件/etc/wireguard/wg0.conf<br>\n# 重要！如果名字不是eth0, 以下PostUp和PostDown处里面的eth0替换成自己服务器显示的名字<br>\n# ListenPort为端口号，可以自己设置想使用的数字<br>\n# 以下内容一次性粘贴执行，不要分行执行<br>\n<br>\necho \"<br>\n[Interface]<br>\nPrivateKey = $(cat spri)<br>\nAddress = 10.222.222.1/24<br>\nPostUp&nbsp; = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o ens4 -j MASQUERADE<br>\nPostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o ens4 -j MASQUERADE<br>\nListenPort = 2222<br>\nDNS = 1.1.1.1<br>\nMTU = 1300<br>\nSaveConfig = true<br>\n<br>\n[Peer]<br>\nPublicKey = $(cat cpub)<br>\nPresharedKey = $(cat PSK)<br>\nAllowedIPs = 10.222.222.2/32 \" &gt; wg0.conf<br>\n<br>\n<br>\n设置开机自启： systemctl enable wg-quick@wg0<br>\n<br>\n<br>\n客户端配置文件<br>\n生成客户端配置文件/etc/wireguard/client.conf:<br>\n# Endpoint是自己服务器ip和服务端配置文件中设置的端口号，自己在本地编辑好再粘贴到SSH里<br>\n# 以下内容一次性粘贴执行，不要分行执行<br>\n<br>\necho \"<br>\n[Interface]<br>\nPrivateKey = $(cat cpri)<br>\nAddress = 10.222.222.2/24<br>\nDNS =1.1.1.1<br>\nMTU = 1300<br>\n<br>\n[Peer]<br>\nPublicKey = $(cat spub)<br>\nPresharedKey = $(cat PSK)<br>\nEndpoint = 《gcp_外网ip》:2222<br>\nAllowedIPs = 0.0.0.0/0, ::0/0<br>\nPersistentKeepalive = 25 \" &gt; client.conf<br>\n<br>\n<br>\n至此，基本上就已经搞定了，可以启动 WireGuard 了：<br>\n<br>\n# 启动WireGuard<br>\nwg-quick up wg0<br>\n<br>\n<br>\n# 停止WireGuard<br>\nwg-quick down wg0<br>\n<br>\n<br>\n# 查看WireGuard运行状态<br>\nwg","date":"2020-02-17","agreeCount":0,"discussionCount":0}