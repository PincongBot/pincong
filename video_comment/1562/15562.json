{"type":"video_comment","id":15562,"parentType":"video","parentId":1562,"uid":18160,"contents":"<center>ESNI细节讲解</center><br>\n先讲流程和细节：<br>\n<br>\nQ1. SNI被加密了，用的是什么加密算法，加密密钥从哪里来？<br>\n<br>\nA1.使用的加密算法是AEAD，具体是哪种AEAD，是协商出来的。密钥是通过PSK协商出来的。<br>\n<br>\nQ2.如果是通过PSK协商，那么服务器的公钥是从哪里来的？<br>\n<br>\nA2.通过DNS得到，具体来说是DNS的 TXT record。<br>\n<br>\nQ3.发起DoH的时候，SNI有没有加密呢？<br>\n<br>\nA3.没有，原因我下面解释<br>\n<br>\n大致流程：<br>\n<br>\n1.火狐通过DNS over HTTPS 发起 请求 服务器的ip地址，还有txt record<br>\n<br>\n2.如果txt record里有公钥信息，说明服务器支持esni，用这个record协商出了aes的密钥<br>\n<br>\n3.用aes密钥加密sni，拼到clienthello的esni字段<br>\n<br>\n4.发送给服务器","date":"2020-04-12","agreeCount":1,"discussionCount":0}