{"type":"article","id":15493,"title":"V2Ray翻墙完全教程(WS+TLS+Web)【请更新V2Ray客户端至4.23.2以上】","uid":20551,"topics":[6222,2198,112,406,1012],"contents":"<center><b>前言</b></center><br>\n本文是搭建V2Ray服务器（ws+tls+web）的完整教程。除了搭建V2Ray+ws+tls+web的过程，还包括配置CDN隐藏IP，打开BBR加速，以及简单配置防火墙防探测。最近（2020年初开始）防火墙加大了封杀VPN的力度，很多SS，SSR，纯VMess都开始间歇掉线，有些代理甚至直接被封IP。如果你打算自己搭建翻墙服务，强烈推荐V2Ray+ws+tls+web（CDN可选）一步到位。<br>\n<br>\n本文面向小白，你只要会购买虚拟主机，会使用SSH连接服务器，那么看懂本教程就毫无压力。当然如果有搭建SS/SSR的经验，就更容易看懂了。建议能看懂本教程的，尽量购买VPS自建翻墙服务。按照本文搭建实在有困难的用户，可以考虑迷雾通或其它外资VPN。<br>\n<br>\n不推荐使用一键脚本，很多一键脚本都存在安全隐患，轻则屏蔽掉几个网站，重则把你的服务器变成“肉鸡”（即黑客攻击别人电脑的跳板）。另外，就算用脚本搭建服务器，本文中的大部分操作，比如购买域名，配置域名解析等等，脚本无法自动完成。你恐怕还要亲自购买域名，亲自配置域名解析，亲自登录VPS执行脚本。本文中的方法只比一键脚本多出几步，但是可以大大降低安全风险。<br>\n<br>\n自建V2Ray服务器首先要购买VPS（虚拟主机），为避免广告嫌疑，正文中不推荐VPS，我会在评论中补充一些常见的外资VPS。一般而言，自建服务的成本远远低于机场，大多数VPS每个月花费20-30元左右，流量1TB/月，有些外资VPS价格低到10-20元，甚至每月不到10元。如果愿意折腾，还可以用免费的谷歌云。此外，自建服务没有客户端数量限制，如果多人分摊成本，价格就更便宜了。<br>\n<br>\nV2Ray+ws+tls+web是目前最稳定的翻墙技术之一，即使在六四、十一也稳如泰山。和SSR的流量混淆不同，V2Ray+ws+tls用真正的https流量翻墙，没有必要做任何混淆。在防火长城看来，你的流量和不计其数的https流量没有任何区别。但是，如果有好事者主动访问你的代理服务器，就会发现一些不对劲：<br>\n<a href=\"https://i.imgur.com/avZQgib.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/avZQgib.png\" alt=\"https://i.imgur.com/avZQgib.png\" style=\"max-width:100%\"></a><br>\n<center>【fig0.1】</center><br>\n尽管流量没有任何明显的特征，但是如果墙主动访问代理服务器，会发现流量的目的地没有真正的网站，从而识破https流量的目的。使用https流量不做掩护，反而增大了IP被墙的概率。因此你需要在V2Ray服务外面加一层真网站做掩护。<br>\n<a href=\"https://i.imgur.com/raSjDmM.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/raSjDmM.png\" alt=\"https://i.imgur.com/raSjDmM.png\" style=\"max-width:100%\"></a><br>\n<center>【fig0.2】</center><br>\n这就是V2Ray+ws+tls再加上web的原理。在配置了真实网站之后，只有你自己知道是个代理，在别人看来是个网站（包括墙）。反过来说，V2Ray+ws+tls+web也可以看作是自建了一个网站，然后利用这个网站来翻墙。因此，如果你读完本文，不仅能学会V2Ray翻墙，还能学到一点建网站的流程。<br>\n<br>\n上面“https流量”的正确叫法是“tls流量”，这东西就是你平时浏览网页发出的流量。这里为了方便新手理解，叫做“https流量”。<br>\n<br>\n<b>安全提示：</b><br>\n<blockquote>如果服务器之前运行过SS，SSR，V2Ray（非TLS）等服务，请确保先停止原来的代理服务，再安装V2Ray。如果不知道怎么停止，请重装VPS（在网页控制面板上点reinstall，不到一分钟就搞定）。翻墙的隐蔽性取决于最薄弱的一环，如果服务器上同时运行其它代理软件，这些代理软件依然会被墙探测到，这种情况下V2Ray+ws+tls+web并不能保证隐蔽性。</blockquote><br>\n<br>\n自建网站看上去很复杂，其实很简单，只要按照以下步骤：<br>\n<br>\n<ul><li>购买域名&amp;配置域名解析：V2Ray需要域名伪装成真正的网站，因此你需要购买一个域名，并把域名绑定到服务器的IP地址上。</li><li>一键填写配置文件：本文已经写好了配置文件，只要把域名，UUID等信息填进去就行了。</li><li>一键安装v2ray+nginx</li><li>上传配置文件&amp;一键运行</li><li>配置客户端</li></ul><br>\n<br>\n成功翻墙以后，还可以做以下事情进一步强化：<br>\n<ul><li>可选1. 加固服务器</li><li>可选2. 配置CDN隐藏IP</li><li>可选3. 使用BBR加速</li><li>可选4. 自行编译Nginx</li></ul><br>\n<br>\n下面按照以上顺序讲解配置。<br>\n<br>\n<br>\n<center><b>1. 购买域名&amp;配置域名解析</b></center><br>\n这里从域名注册商GoDaddy购买域名，用Cloudflare提供域名解析。GoDaddy本身也提供域名解析服务，这里用Cloudflare是为了配置CDN方便。如果遇到墙加高，或者IP被墙等极端情况，只要简单的配置就可以切换成v2ray+ws+tls+web+cdn。CDN翻墙速度较慢，但是稳定性极高。<br>\n<br>\n可能不少新手没听说过GoDaddy和Cloudflare，这里介绍一下，GoDaddy是世界上最大的域名提供商，占据市场30%的份额。Cloudflare是世界上最大的CDN提供商，全球半数的网站都在使用Cloudflare。注册不用担心隐私泄露或钓鱼风险。<br>\n<br>\n注册GoDaddy和CloudFlare需要邮箱。特别注意，购买域名之后，域名服务商会公开邮箱地址。建议至少使用gmail注册，如果对隐私有较高要求，可以用Protonmail等匿名邮箱注册。<br>\n<br>\n<center><b>1.1 注册GoDaddy</b></center><br>\n点击这里进入<a href=\"https://sg.godaddy.com/zh\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">GoDaddy的新加坡官网</a>，全过程都有中文界面。出于安全考虑，选择邮箱注册。<br>\n<a href=\"https://i.imgur.com/bu3N2ZK.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/bu3N2ZK.png\" alt=\"https://i.imgur.com/bu3N2ZK.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.1.1】</center><br>\n<br>\n<center><b>1.2 选择一个域名</b></center><br>\nGoDaddy和淘宝的用法完全一样。注册完成以后，回到GoDaddy首页。点击搜索框，输入一个你想要的域名，查询价格。GoDaddy会根据域名包含的词汇定价，为了降低成本，域名尽量选得随机一些，其中不要包含任何单词，我这里头滚键盘输入hrw1rdzqa7c5a8u3ibkn。<br>\n<a href=\"https://i.imgur.com/IxWvPW8.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/IxWvPW8.png\" alt=\"https://i.imgur.com/IxWvPW8.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.2.1】</center><br>\n可以看到不同后缀的域名价格差别很大，通常.com .net这类域名比较昂贵.website，.site，<s>.rocks，.xyz</s>价格较低，选一个最便宜的。这里我们选www.hrw1rdzqa7c5a8u3ibkn.website，这个域名一年不到7块钱。如果你购买时发现价格贵一些也是正常的，域名首年的价格通常不到10块钱。<br>\n<a href=\"https://i.imgur.com/ywKsYoB.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/ywKsYoB.png\" alt=\"https://i.imgur.com/ywKsYoB.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.2.2】</center><br>\n接下来进入购物车，隐私保护不用选。<br>\n<a href=\"https://i.imgur.com/8fM0rJP.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/8fM0rJP.png\" alt=\"https://i.imgur.com/8fM0rJP.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.2.3】</center><br>\n点进入购物车，进入结算页面。GoDaddy默认选购买2年，我们的域名只用来翻墙，选1年就可以了，到时候再换。<br>\nGoDaddy支持支付宝或信用卡付款。第一次购买域名，GoDaddy会要求你填写个人信息，这里姓名和手机号随便填一个假的就行。<br>\n<a href=\"https://i.imgur.com/NACRyMf.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/NACRyMf.png\" alt=\"https://i.imgur.com/NACRyMf.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.2.4】</center><br>\n购买完成，刚买到的域名不会马上在域名列表里出现，一般会有一两分钟的延迟。<br>\n接下来注册Cloudflare。GoDaddy的页面暂时不要关，一会还要回来配置域名服务器。<br>\n<br>\n<center><b>1.3 注册CloudFlare。</b></center><br>\n打开Cloudflare官网，用邮箱注册，如图。注册页面入口<a href=\"https://dash.cloudflare.com/sign-up\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">https://dash.cloudflare.com/sign-up</a><br>\n<a href=\"https://i.imgur.com/S2epVPg.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/S2epVPg.png\" alt=\"https://i.imgur.com/S2epVPg.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.3.1】</center><br>\n接下来输入刚才购买的域名，注意这里输入的是【二级域名】。所谓二级域名，可以理解为网址去掉www。<br>\n比如我的网站的网址是www.hrw1rdzqa7c5a8u3ibkn.website，那么这里应该输入hrw1rdzqa7c5a8u3ibkn.website，如图：<br>\n<a href=\"https://i.imgur.com/Q8Q5TA9.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/Q8Q5TA9.png\" alt=\"https://i.imgur.com/Q8Q5TA9.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.3.2】</center><br>\n点【Add Site】，把域名交给Cloudflare托管。<br>\n<br>\n接下来选择套餐，这里选择FREE套餐。<br>\n<a href=\"https://i.imgur.com/brAXbxG.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/brAXbxG.png\" alt=\"https://i.imgur.com/brAXbxG.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.3.3】</center><br>\n点【Confirm Plan】，进入管理页面，不要关掉页面，接下来配置域名解析。<br>\n<br>\n<center><b>1.4 配置域名解析</b></center><br>\n配置域名解析分两步：<br>\n<ul><li>配置域名服务器记录（也叫name server，NS记录）</li><li>配置地址解析记录（也叫address，A记录）</li></ul><br>\n<br>\nNS记录用来表明由哪台服务器对域名进行解析。从GoDaddy买到域名后，域名是由Godaddy的服务器进行解析的。我们这里把Godaddy的服务器换成Cloudflare的服务器。<br>\n<br>\n如图是Cloudflare的管理界面，如果你的域名之前有配置域名解析，管理界面会显示之前的记录。暂时不用管这些。<br>\n点Continue，修改域名服务器。<br>\n<br>\n<center>【fig1.4.1】</center><br>\n点【Continue with default】<br>\n<a href=\"https://i.imgur.com/YiZuOAP.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/YiZuOAP.png\" alt=\"https://i.imgur.com/YiZuOAP.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.2】</center><br>\n接下来Cloudflare会提示你变更域名服务器，并给出了方法。<br>\n<a href=\"https://i.imgur.com/HTUNjSb.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/HTUNjSb.png\" alt=\"https://i.imgur.com/HTUNjSb.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.3】</center><br>\n画红框的部分就是Cloudflare提供的两个域名服务器，我这里是ns90.domaincontrol.com和ns91.domaincontrol.com，<br>\n你看到的的可能和我不一样。<br>\n<br>\n回到<a href=\"https://sg.godaddy.com/zh\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">GoDaddy</a>，点击屏幕右上角的用户名，选择【我的产品】。<br>\n<a href=\"https://i.imgur.com/H7iSxUX.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/H7iSxUX.png\" alt=\"https://i.imgur.com/H7iSxUX.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.4】</center><br>\n这里可以看到你拥有的域名，点击域名旁边的【DNS】，进入DNS管理页面。<br>\n<a href=\"https://i.imgur.com/he6OqIE.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/he6OqIE.png\" alt=\"https://i.imgur.com/he6OqIE.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.5】</center><br>\n在DNS管理界面向下拉，找到域名服务器。如图所示，这里可以看到GoDaddy提供的两个域名服务器，点击【更改】。<br>\n<a href=\"https://i.imgur.com/LBZ5vNd.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/LBZ5vNd.png\" alt=\"https://i.imgur.com/LBZ5vNd.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.6】</center><br>\n选择【输入我自己的域名服务器】<br>\n<a href=\"https://i.imgur.com/93ic5KS.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/93ic5KS.png\" alt=\"https://i.imgur.com/93ic5KS.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.7】</center><br>\n输入刚才Cloudflare提供的两个域名服务器，我这里是fccp.ns.cloudflare.com和xjp.ns.cloudflare.com，<br>\n点击【保存】。<br>\n<a href=\"https://i.imgur.com/LUl7HAd.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/LUl7HAd.png\" alt=\"https://i.imgur.com/LUl7HAd.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.8】</center><br>\n注意不要有多余的域名服务器，不是CloudFlare提供的就要删除，否则可能会出问题。<br>\n<br>\n接下来转移域名服务器可能需要几分钟，转移完成后会收到Cloudflare的邮件，可以先等一阵子。<br>\n<br>\n配置地址解析（A记录）<br>\n转移域名服务器完成后，进入<a href=\"https://www.cloudflare.com\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">cloudflare的首页</a>，点击右上角的【log in】，进入你的账户，如图：<br>\n<a href=\"https://i.imgur.com/rdFD2Ke.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/rdFD2Ke.png\" alt=\"https://i.imgur.com/rdFD2Ke.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.9】</center><br>\n点击买来的域名，进入下一步，如图：<br>\n<a href=\"https://i.imgur.com/dMSA0xq.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/dMSA0xq.png\" alt=\"https://i.imgur.com/dMSA0xq.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.10】</center><br>\n点击【DNS】按钮，进入Cloudflare的DNS管理页面，如下图：<br>\n<a href=\"https://i.imgur.com/BCeOWfm.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/BCeOWfm.png\" alt=\"https://i.imgur.com/BCeOWfm.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.11】</center><br>\n点击【Add record】，一次可以添加一条解析记录.<br>\n<br>\n这里简单讲解一下，如果不想了解原理，可以跳过这一部分。<br>\n<br>\n每条域名解析有四个部分：Type，Name，Address，TTL<br>\n<br>\nType是域名解析的类型，常见的几种有<br>\n<ul><li>A记录：即地址（Address）记录，用来指定域名的IPv4地址。如果需要将域名指向一个IP地址，就需要添加A记录。举个例子，我们要把域名www.hrw1rdzqa7c5a8u3ibkn.website指向VPS的IP地址218.30.118.6，就要添加A记录。</li><li>AAAA记录，指定域名的IPv6地址。</li><li>CNAME：即规范名字（Canonical Name）记录，俗称“别名”。如果需要把域名指向另一个域名，就要添加CNAME记录。</li><li>NS：域名服务器记录，如果要把域名交给其他DNS服务器解析，就需要添加NS记录。我们刚才修改的就是NS记录。</li></ul><br>\n<br>\n接下来说明每个选项应该填什么，以及为什么这么填：<br>\n<br>\n<b>Name</b><br>\n对于A记录，这里介绍三种填法<br>\n<ul><li>www：表示解析带www的域名，即www.hrw1rdzqa7c5a8u3ibkn.website</li><li>@：直接解析裸域名，即hrw1rdzqa7c5a8u3ibkn.website</li><li>*：表示泛解析，即匹配其他所有域名 *.hrw1rdzqa7c5a8u3ibkn.website</li></ul><br>\n<br>\n<b>Address</b><br>\n这里填VPS的IP地址，我这里是218.30.118.6<br>\n<br>\n<b>TTL</b><br>\n即 Time To Live，缓存的生存时间。指本地dns缓存解析记录的时间，缓存失效后会再次获取记录。在Cloudflare里，如果配置了CDN，则这里填Auto即可；如果没有配置CDN，可以选择Auto，也可以选择一个大于1小时的值。<br>\n<br>\n理解了上面的内容以后，接下来添加两条A记录（如果VPS只有IPv6地址则添加AAAA记录）<br>\n<br>\n点一下云朵，确保云是灰色的（DNS only）。橘色云朵表示此解析记录使用CDN，灰色云朵表示不使用 CDN，点击云朵可以切换。这里不要使用CDN，否则接下来的配置会出问题。<br>\n<ul><li>第一条A记录，name填www，address填服务器IP地址，TTL选择1小时。（表示解析带www的地址）</li><li>第二条A记录，name填@，address填服务器IP地址，TTL选择1小时。（表示解析不带www的裸域名）</li></ul><br>\n<br>\n填好之后的正确结果如图：<br>\n<a href=\"https://i.imgur.com/qDKfuRy.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/qDKfuRy.png\" alt=\"https://i.imgur.com/qDKfuRy.png\" style=\"max-width:100%\"></a><br>\n<center>【fig1.4.12】</center><br>\n注意云一定是灰色的。<br>\n<br>\n<br>\n<b>检查是否配置成功：</b><br>\n配置完成后点【save】就大功告成了，可以打开windows的powershell，输入<br>\n<pre>ping www.hrw1rdzqa7c5a8u3ibkn.website</pre><br>\n(替换成你的域名)<br>\n<br>\nPing一下你的域名，如果能Ping通，就说明域名解析没问题。<br>\n<br>\n<br>\n<center><b>2. 配置文件</b></center><br>\nV2Ray和Nginx的配置文件这里已经写好。你需要做的就是填表格，把配置中标出的地方换成自己的内容。<br>\n编辑配置文件可以用Windows记事本，不过推荐使用Notepad++。<br>\n下载地址：<br>\n<a href=\"https://notepad-plus-plus.org/downloads/\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">网页链接</a>，<a href=\"https://github.com/notepad-plus-plus/notepad-plus-plus/releases/download/v7.8.4/npp.7.8.4.Installer.x64.exe\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">直接下载链接(7.8.4)</a><br>\n<br>\n<center><b>2.1 V2Ray配置文件</b></center><br>\nV2Ray配置文件如下：<br>\n<pre>{<br>\n\"inbound\": {<br>\n&nbsp; &nbsp; \"protocol\": \"vmess\",<br>\n&nbsp; &nbsp; \"listen\": \"127.0.0.1\",<br>\n \"port\": 8964,<br>\n \"settings\": {\"clients\": [<br>\n&nbsp; &nbsp; &nbsp; &nbsp; {\"id\": \"◆◆◆◆◆◆◆◆◆◆◆◆\"}<br>\n&nbsp; &nbsp; ]},<br>\n \"streamSettings\": {<br>\n \"network\": \"ws\",<br>\n \"wsSettings\": {\"path\": \"/★★★★★★★★★★★★\"}<br>\n&nbsp; &nbsp; }<br>\n},<br>\n<br>\n\"outbound\": {\"protocol\": \"freedom\"}<br>\n}</pre><br>\n是不是很短？接下来把标了符号的地方换成你自己的信息。<br>\n<br>\n<b>(1)</b><br>\n◆◆◆◆◆◆◆◆◆◆◆◆：标“◆”的地方填写UUID。<br>\n<br>\nUUID可以从这个网站生成：<a href=\"https://www.uuidgenerator.net/\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">https://www.uuidgenerator.net/</a>。只要打开或者刷新这个网页就可以得到一个UUID。<br>\n举个例子，我生成的UUID是：<br>\n<br>\n<blockquote>63c0042a-4a85-4d03-a488-3ba3aa002461</blockquote><br>\n<br>\n<b>(2)</b><br>\n★★★★★★★★★★★★：标“★”的地方填写一个随机字符串。注意不要删掉前面的斜杠。<br>\n<br>\n“随机字符串”就是你在键盘上胡乱敲打出来的东西，比如dsfhsdjfhref。<a href=\"https://www.random.org/strings/?num=1&amp;len=7&amp;digits=on&amp;upperalpha=on&amp;loweralpha=on&amp;unique=off&amp;format=html&amp;rnd=new\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">推荐用这个网站生成一个</a>，只要打开或刷新网页就可以得到一个随机字符串。<br>\n<br>\n我用这个网站随机生成的字符串是mL7Gg8K<br>\n<br>\n这个随机字符串就是WebSocket路径，<b>不要抄我这里的例子，去自己生成一个！</b>否则会被墙探测出来。建议WebSocket路径取得长一些（5个字符以上），过于简单，过于常见的路径（比如/ray，/v2，/v2ray之类的名称），很容易被墙探测出来。<br>\n<br>\n填好之后的配置如下图：<br>\n<a href=\"https://i.imgur.com/K1FEnrw.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/K1FEnrw.png\" alt=\"https://i.imgur.com/K1FEnrw.png\" style=\"max-width:100%\"></a><br>\n<center>【fig2.1.1】</center><br>\n最后，把V2Ray的配置文件另存为config.json<br>\n<br>\n<center><b>2.2 Nginx配置文件</b></center><br>\nNginx配置文件如下：<br>\n<pre><br>\nserver {<br>\n&nbsp; &nbsp; ### 1:<br>\n&nbsp; &nbsp; server_name ●●●●●●●●●●●●;<br>\n<br>\n&nbsp; &nbsp; listen 80 reuseport fastopen=10;<br>\n&nbsp; &nbsp; rewrite ^(.*) https://$server_name$1 permanent;<br>\n&nbsp; &nbsp; if ($request_method&nbsp; !~ ^(POST|GET)$) { return&nbsp; 501; }<br>\n&nbsp; &nbsp; autoindex off;<br>\n&nbsp; &nbsp; server_tokens off;<br>\n}<br>\n<br>\nserver {<br>\n&nbsp; &nbsp; ### 2:<br>\n&nbsp; &nbsp; ssl_certificate /etc/letsencrypt/live/●●●●●●●●●●●●/fullchain.pem;<br>\n<br>\n&nbsp; &nbsp; ### 3:<br>\n&nbsp; &nbsp; ssl_certificate_key /etc/letsencrypt/live/●●●●●●●●●●●●/privkey.pem;<br>\n<br>\n&nbsp; &nbsp; ### 4:<br>\n&nbsp; &nbsp; location /★★★★★★★★★★★★<br>\n&nbsp; &nbsp; {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; proxy_pass http://127.0.0.1:8964;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; proxy_redirect off;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; proxy_http_version 1.1;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; proxy_set_header Upgrade $http_upgrade;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; proxy_set_header Connection \"upgrade\";<br>\n&nbsp; &nbsp; &nbsp; &nbsp; proxy_set_header Host $host;<br>\n<br>\n&nbsp; &nbsp; &nbsp; &nbsp; sendfile on;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; tcp_nopush on;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; tcp_nodelay on;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; keepalive_requests 10000;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; keepalive_timeout 2h;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; proxy_buffering off;<br>\n&nbsp; &nbsp; }<br>\n<br>\n&nbsp; &nbsp; listen 443 ssl reuseport fastopen=10;<br>\n&nbsp; &nbsp; server_name $server_name;<br>\n&nbsp; &nbsp; charset utf-8;<br>\n<br>\n&nbsp; &nbsp; sendfile on;<br>\n&nbsp; &nbsp; tcp_nopush on;<br>\n&nbsp; &nbsp; tcp_nodelay on;<br>\n&nbsp; &nbsp; keepalive_requests 10000;<br>\n&nbsp; &nbsp; keepalive_timeout 2h;<br>\n<br>\n&nbsp; &nbsp; ssl_protocols TLSv1.2 TLSv1.3;<br>\n&nbsp; &nbsp; ssl_ciphers TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;<br>\n&nbsp; &nbsp; ssl_ecdh_curve secp384r1;<br>\n&nbsp; &nbsp; ssl_prefer_server_ciphers off;<br>\n<br>\n&nbsp; &nbsp; ssl_session_cache shared:SSL:60m;<br>\n&nbsp; &nbsp; ssl_session_timeout 1d;<br>\n&nbsp; &nbsp; ssl_session_tickets off;<br>\n&nbsp; &nbsp; ssl_stapling on;<br>\n&nbsp; &nbsp; ssl_stapling_verify on;<br>\n&nbsp; &nbsp; resolver 8.8.8.8 8.8.4.4 valid=300s;<br>\n&nbsp; &nbsp; resolver_timeout 10s;<br>\n<br>\n&nbsp; &nbsp; if ($request_method&nbsp; !~ ^(POST|GET)$) { return 501; }<br>\n&nbsp; &nbsp; add_header X-Frame-Options DENY;<br>\n&nbsp; &nbsp; add_header X-XSS-Protection \"1; mode=block\";<br>\n&nbsp; &nbsp; add_header X-Content-Type-Options nosniff;<br>\n&nbsp; &nbsp; add_header Strict-Transport-Security max-age=31536000 always;<br>\n&nbsp; &nbsp; autoindex off;<br>\n&nbsp; &nbsp; server_tokens off;<br>\n<br>\n&nbsp; &nbsp; index index.html index.htm&nbsp; index.php;<br>\n&nbsp; &nbsp; location ~ .*\\.(js|jpg|JPG|jpeg|JPEG|css|bmp|gif|GIF|png)$ { access_log off; }<br>\n&nbsp; &nbsp; location / { index index.html; }<br>\n}<br>\n</pre><br>\n看上去很长，实际上只有四处需要填写，配置文件里用#1，#2，#3，#4标出了位置，把标符号的地方换成你自己的信息。<br>\n<br>\n●●●●●●●●●●●●：标注“●”的地方填写域名，<b>注意这里的域名带www</b><br>\n<br>\n这个域名就是前面购买的域名，本文中是www.hrw1rdzqa7c5a8u3ibkn.website，一共有三处需要填，都以“●”标出：<br>\n<br>\n<b>(1)</b> server_name ●●●●●●●●●●●●; 注意域名和前面的server_name保持一个空格，后面的分号“;”不要删掉。<br>\n填好之后：（注意带www，以下皆相同）<br>\n<pre>server_name www.hrw1rdzqa7c5a8u3ibkn.website;</pre><br>\n<b>(2)</b> ssl_certificate /etc/letsencrypt/live/●●●●●●●●●●●●/fullchain.pem; 两边的斜杠“/”不要删掉。<br>\n填好之后：<br>\n<pre>ssl_certificate /etc/letsencrypt/live/www.hrw1rdzqa7c5a8u3ibkn.website/fullchain.pem;</pre><br>\n<b>(3)</b> ssl_certificate /etc/letsencrypt/live/●●●●●●●●●●●●/fullchain.pem; 一样，两边的斜杠“/”不要删掉<br>\n填好之后：<br>\n<pre>ssl_certificate /etc/letsencrypt/live/www.hrw1rdzqa7c5a8u3ibkn.website/fullchain.pem;</pre><br>\n<b>(4) </b>★★★★★★★★★★★★：标注“★”的地方填写一个随机字符串，这个随机字符串必须和V2Ray配置中的一样，不然无法工作。注意不要删掉前面的斜杠。<br>\n这个例子里，此处填mL7Gg8K。<br>\n<br>\n填好之后的配置如下图：<br>\n<a href=\"https://i.imgur.com/Vc5LhXw.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/Vc5LhXw.png\" alt=\"https://i.imgur.com/Vc5LhXw.png\" style=\"max-width:100%\"></a><br>\n<center>【fig2.1.2】</center><br>\n最后，把Nginx的配置文件另存为default.conf（注意扩展名就是.conf）<br>\n<br>\n<br>\n<center><b>3. 上传配置 &amp; 运行</b></center><br>\n<center><b>3.1 连接到服务器，安装v2ray+Nginx</b></center><br>\n很多新手在买到VPS之后不知所措，其实VPS和游戏账号是一样的，买游戏账号付款之后，店家会私信告诉你两件东西：<br>\n<blockquote>用户名，密码</blockquote><br>\n<br>\n买VPS付款之后，VPS提供商会给你发邮件，告诉你四件东西：<br>\n<blockquote>IP地址，密码，登录账号，端口</blockquote><br>\n<br>\nIP地址和密码一定会有，登录账号如果没说，默认是root。端口如果没说，默认填22.<br>\n<br>\n拿到登录信息之后，就可以登录服务器了。这里推荐Bitvise SSH，轻量级，但是功能强大。<br>\n下载链接：<a href=\"https://www.bitvise.com/ssh-client-download\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">https://www.bitvise.com/ssh-client-download</a><br>\n直接下载链接：<a href=\"https://dl.bitvise.com/BvSshClient-Inst.exe\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">https://dl.bitvise.com/BvSshClient-Inst.exe</a><br>\n安装好之后的界面如下图，点红框圈起的下拉菜单，【Initial method】下拉菜单里面选【password】，在【Store encrypted password in profile】选项上打勾。<br>\n<a href=\"https://i.imgur.com/FliqoSK.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/FliqoSK.png\" alt=\"https://i.imgur.com/FliqoSK.png\" style=\"max-width:100%\"></a><br>\n<center>【fig3.1.1】</center><br>\n这里假定我们的IP地址是218.30.118.6，密码是12345，登录账号和密码分别是root和22. 如图：<br>\n<ul><li>【Host】：这里填IP地址</li><li>【Port】：这里填端口，如果没说就是22</li><li>【Username】：这里填用户名，如果没说就是root</li><li>【Password】：登录密码。</li></ul><br>\n填好之后如下图，点【Log in】就可以登录了。<br>\n<a href=\"https://i.imgur.com/mWm5Oxq.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/mWm5Oxq.png\" alt=\"https://i.imgur.com/mWm5Oxq.png\" style=\"max-width:100%\"></a><br>\n<center>【fig3.1.2】</center><br>\n第一次登录服务器会弹出窗口，问是否要保存密钥，点【Accept and save】继续。<br>\n<br>\n成功登录之后会弹出两个窗口。<br>\n<a href=\"https://i.imgur.com/DvucZdx.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/DvucZdx.png\" alt=\"https://i.imgur.com/DvucZdx.png\" style=\"max-width:100%\"></a><br>\n<center>【fig3.1.3】</center><br>\n<a href=\"https://i.imgur.com/UNzAKOO.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/UNzAKOO.png\" alt=\"https://i.imgur.com/UNzAKOO.png\" style=\"max-width:100%\"></a><br>\n<center>【fig3.1.4】</center><br>\n一个是文件浏览窗口，使用方法和Windows资源管理器一样，这里可以浏览服务器上的文件。把电脑中的文件拖拽到这里，就可以把文件上传到服务器。<br>\n另一个黑色的窗口是命令窗口。在电脑上复制一段文字，在这个窗口上右键，就可以把文字粘贴到命令窗口。<br>\n<br>\n<center><b>3.2 配置SSL证书</b></center><br>\n为了用真正的https流量翻墙，我们的网站必须有合法的SSL证书。可以用自动化工具Certbot申请证书，只要把以下命令复制到命令窗口，依次执行即可。<br>\n<br>\n这里说的“证书”，实际指的是“数字证书”。当然申请完全是免费的，申请时需要邮箱地址。如有必要，可以使用匿名邮箱。<br>\n<br>\n<b>(1) 安装Certbot：</b><br>\n<pre>yum install -y python36 &amp;&amp; pip3 install certbot</pre><br>\n<br>\n运行这条命令后，如果显示：<br>\n<blockquote>Successfully installed xxxx, xxxx, xxxx (各种软件包名字)</blockquote><br>\n就表示成功。<br>\n<br>\n<b>(2) 停止防火墙</b><br>\n<pre>systemctl stop firewalld &amp;&amp; systemctl disable firewalld</pre><br>\n注意，在CentOS7版本以上，默认开启防火墙，<b>不关闭防火墙将无法申请证书</b>。某些系统上没有安装firewalld防火墙，执行这一步命令会报错，但是不影响后面的操作。<br>\n<br>\n运行这条命令后，如果显示：<br>\n<blockquote>Removed /etc/systemd/system/multi-user.target.wants/firewalld.service.<br>\nRemoved /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</blockquote><br>\n就表示成功<br>\n<br>\n<b>(3) 申请SSL证书</b><br>\n这一步做个填空题，把这条命令里的域名和邮箱，换成你自己的信息。<br>\n<pre>certbot certonly --standalone --agree-tos -n -d www.●●●●●● -d ●●●●●● -m ▲▲▲@▲▲▲.▲▲▲</pre><br>\n第一个-d加一个带www的域名，第二个-d加一个不带www的域名，-m后面加你的电子邮箱。<br>\n注意前后要带空格。<br>\n<br>\n例子：（域名：www.hrw1rdzqa7c5a8u3ibkn.website，邮箱：xijinping@protonmail.com）<br>\n<pre>certbot certonly --standalone --agree-tos -n -d www.hrw1rdzqa7c5a8u3ibkn.website -d hrw1rdzqa7c5a8u3ibkn.website -m xijinping@protonmail.com</pre><br>\n运行这条命令后，如果显示：<br>\n<blockquote>IMPORTANT NOTES:<br>\n- Congratulations! Your certificate and chain have been saved at:<br>\n&nbsp; /etc/letsencrypt/live/www.hrw1rdzqa7c5a8u3ibkn.website/fullchain.pem<br>\n&nbsp; Your key file has been saved at:<br>\n&nbsp; /etc/letsencrypt/live/www.hrw1rdzqa7c5a8u3ibkn.website/privkey.pem<br>\n&nbsp; Your cert will expire on 2020-06-04. To obtain a new or tweaked<br>\n&nbsp; version of this certificate in the future, simply run certbot<br>\n&nbsp; again. To non-interactively renew *all* of your certificates, run<br>\n&nbsp; \"certbot renew\"<br>\n- Your account credentials have been saved in your Certbot<br>\n&nbsp; configuration directory at /etc/letsencrypt. You should make a<br>\n&nbsp; secure backup of this folder now. This configuration directory will<br>\n&nbsp; also contain certificates and private keys obtained by Certbot so<br>\n&nbsp; making regular backups of this folder is ideal.<br>\n- If you like Certbot, please consider supporting our work by:<br>\n<br>\n&nbsp; Donating to ISRG / Let's Encrypt:&nbsp; https://letsencrypt.org/donate<br>\n&nbsp; Donating to EFF:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; https://eff.org</blockquote><br>\n<br>\n就表示成功。<br>\n<br>\n注意：这一步比较容易出错，常见的问题有：<br>\n<ul><li>其它代理占用了80，443端口。解决方法：停止其它代理软件，或重装VPS。</li><li>没有正确配置域名解析。解决方法：ping一下域名，看看能不能正确解析到IP。注意不要打开CDN（云朵点灰）。</li><li>没有关闭防火墙。解决方法：回到（2），关闭防火墙。</li></ul><br>\n<br>\n<b>(4) 配置证书自动更新</b><br>\n<pre>echo \"0 0 1 */2 * service nginx stop; certbot renew; service nginx start;\" | crontab</pre><br>\n运行这条命令后，如果没有任何信息输出，就表示成功。<br>\n<br>\n我们申请的证书只有三个月期限，上面的命令表示每隔两个月，证书就自动续命一次，从而保证可以一直用下去。<br>\n<br>\n<b>3.3 安装V2Ray和Nginx</b><br>\n<b>(1) 一键安装</b><br>\nV2Ray和Nginx可以一键安装，把下列命令复制粘贴到控制台，运行即可。<br>\n<br>\n<pre>yum install -y nginx &amp;&amp; yum install -y curl &amp;&amp; bash -c \"$(curl -L -s https://install.direct/go.sh)\"</pre><br>\n运行这条命令后，如果最后一行显示：<br>\nV2Ray v4.x.x is installed.<br>\n就表示成功。（如果V2Ray安装成功，那么Nginx也一定安装成功）<br>\n<br>\n<b>(2) 关闭SELinux</b><br>\n在某些系统上，需要关闭SELinux，否则Nginx无法正常将流量转发给V2Ray，输入<br>\n<pre>setsebool -P httpd_can_network_connect 1 &amp;&amp; setenforce 0</pre><br>\n关闭SELinux，没有提示就表示成功。<br>\n<br>\n<center><b>4. 上传配置文件&amp;运行</b></center><br>\n安装好V2Ray和Nginx后，我们终于来到了最后一步。在启动V2Ray之前，需要把之前的配置文件上传<br>\n<br>\n<center><b>4.1 上传配置文件</b></center><br>\n这一步把第（2）步编辑好的配置文件上传就可以了。<br>\n首先上传V2Ray的配置文件，V2Ray的配置文件存储在<br>\n<pre>/etc/v2ray</pre><br>\n目录下，把上面这个路径，复制到文件管理器的路径栏，回车，即可跳转到该目录下。如图：<br>\n<a href=\"https://i.imgur.com/Cj92ghh.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/Cj92ghh.png\" alt=\"https://i.imgur.com/Cj92ghh.png\" style=\"max-width:100%\"></a><br>\n<center>【fig4.1.1】</center><br>\n可以看到这里已经有一个config.json文件了，这是V2Ray安装时自动生成的。接下来的操作和Windows一样，把你编辑好的config.json拖拽到这里，就可以上传了。<br>\n<br>\n文件管理器会提示你存在同名文件，选择【Overwrite】覆盖原来的文件即可。<br>\n<a href=\"https://i.imgur.com/n0Uqnj7.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/n0Uqnj7.png\" alt=\"https://i.imgur.com/n0Uqnj7.png\" style=\"max-width:100%\"></a><br>\n<center>【fig4.1.2】</center><br>\n上传完成好以后，最好再验证一下，输入<br>\n<pre>/usr/bin/v2ray/v2ray -test -config=/etc/v2ray/config.json</pre><br>\n如果显示：<br>\n<blockquote>V2Ray 4.x.x (V2Fly, a community-driven edition of V2Ray.)<br>\nA unified platform for anti-censorship.<br>\nConfiguration OK.</blockquote><br>\n<br>\n说明配置没有问题。<br>\n<br>\n然后按同样的步骤上传nginx配置文件，Nginx的配置文件存储在<br>\n<pre>/etc/nginx/conf.d</pre><br>\n目录下，转到这个目录，拖拽上传你编辑的default.conf文件即可。<br>\n<br>\n再验证一下Nginx配置是否正确，输入：<br>\n<pre>nginx -t</pre><br>\n如果显示：<br>\n<blockquote>nginx: the configuration file /etc/nginx/ngin短网址nf syntax is ok<br>\nnginx: configuration file /etc/nginx/ngin短网址nf test is successful</blockquote><br>\n<br>\n说明配置没有问题。<br>\n<br>\n<center><b>4.2 启动</b></center><br>\nV2Ray和Nginx都是守护进程，可以认为是Windows上的“后台服务”。把V2Ray和Nginx配置成守护进程以后，这两个程序就可以在服务器上持续运行了。Linux服务器的稳定性非常高，可以连续不重启运行一年，甚至更长。我们接下来就让V2Ray和Nginx在服务器上运行一年。<br>\n<br>\n在Linux上启动一个守护进程很简单，输入以下两条命令就可以启动V2Ray和Nginx：<br>\n<br>\n<pre>service v2ray start<br>\nservice nginx start</pre><br>\n有启动，也有其它操作，这里列出所有有用的命令，方便管理后台：<br>\n<br>\n启动V2Ray:<br>\n<pre>service v2ray start</pre><br>\n重启V2Ray:<br>\n<pre>service v2ray restart</pre><br>\n注：这一条是常用命令，每次修改配置文件后，都要重启一下V2Ray。<br>\n<br>\n查看V2Ray状态：<br>\n<pre>service v2ray status</pre><br>\n停止V2Ray：<br>\n<pre>service v2ray stop</pre><br>\n查看V2Ray版本:<br>\n<pre>/usr/bin/v2ray/v2ray -version</pre><br>\n测试V2Ray配置文件:<br>\n<pre>/usr/bin/v2ray/v2ray -test -config=/etc/v2ray/config.json</pre><br>\n注：常用命令，每次修改配置文件后，最好检查一下配置文件是否正确。<br>\n配置文件位置：<br>\n<pre>/etc/v2ray/config.json </pre><br>\nNginx：<br>\n启动Nginx:<br>\n<pre>service nginx start</pre><br>\n重启Nginx:<br>\n<pre>service nginx restart</pre><br>\n查看Nginx状态：<br>\n<pre>service nginx status</pre><br>\n停止Nginx：<br>\n<pre>service nginx stop</pre><br>\n测试Nginx配置文件:<br>\n<pre>nginx -t</pre><br>\n配置文件位置：<br>\n<pre>/etc/nginx/conf.d/default.conf</pre><br>\n配置完成后，可以在浏览器里输入网址，如果显示Nginx的红色欢迎页面，就说明网址配置成功了！<br>\n接下来要做的是上传一个网页模板，这样别人访问你的服务器就会看到一个真的网站。<br>\n<a href=\"https://i.imgur.com/Npk1rOW.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/Npk1rOW.png\" alt=\"https://i.imgur.com/Npk1rOW.png\" style=\"max-width:100%\"></a><br>\n<center>【fig4.2.1】</center><br>\n<br>\n<center><b>4.3 上传网页模板</b></center><br>\n去Google上搜“website template”可以找到很多提供网页模板的网站，这里随便找一家，例如<a href=\"https://colorlib.com/wp/templates/\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">https://colorlib.com/wp/templates/</a><br>\n<br>\n网页模板强烈建议用纯英文模板，其中不要包含任何中文内容，否则（可能）会增加网站被墙的概率。<br>\n<br>\n下载好以后，解压压缩文件，一路点开，如图，可以看到里面有一个index.html文件(有些是index.htm或index.php)<br>\n<a href=\"https://i.imgur.com/8UXO1Ul.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/8UXO1Ul.png\" alt=\"https://i.imgur.com/8UXO1Ul.png\" style=\"max-width:100%\"></a><br>\n<center>【fig4.3.1】</center><br>\n把这个文件夹里的所有东西，包括index.html，blog.html，以及css，fonts，img，js几个文件夹，全部上传到<br>\n/usr/share/nginx/html/<br>\n目录下面。上传方法前面已有介绍，打开Bitvise SSH，拖动到文件管理窗口即可上传。<br>\n<br>\n接下来打开网址，这时候可以看到一个<b>真正的网站</b>。(提示：不同系统的Nginx欢迎页面可能不同，只要这里可以显示网页，就说明Nginx工作正常)<br>\n<br>\n<center><b>5. 客户端配置</b></center><br>\n<center><b>5.1 Windows客户端</b></center><br>\nWindows客户端推荐V2RayN，V2RayN是开源软件，下载地址：<br>\n<a href=\"https://github.com/2dust/v2rayN/releases\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">https://github.com/2dust/v2rayN/releases</a><br>\n<br>\n可以看到有一个v2rayN-Core.zip和一个v2rayN.zip，这里下载v2rayN-Core.zip（GUI界面+V2Ray内核）。<br>\n<br>\n安装好V2RayN之后，如图<br>\n<a href=\"https://i.imgur.com/UP27H1F.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/UP27H1F.png\" alt=\"https://i.imgur.com/UP27H1F.png\" style=\"max-width:100%\"></a><br>\n<center>【fig5.1.1】</center><br>\n点【服务器】按钮，选择【添加VMess】服务器。<br>\n<ul><li>地址：你的VPS的IP地址，这里我的IP是218.30.118.6。</li><li>端口：443</li><li>用户ID：就是2.1节中，V2Ray配置文件里的UUID，本文中是63c0042a-4a85-4d03-a488-3ba3aa002461</li><li>额外ID：0（保持默认值）</li><li>加密方式：随便选。</li><li>传输协议：选ws，即WebSocket</li><li>别名：随便填。</li><li>伪装类型：none（保持默认值）</li><li>伪装域名：绑定到服务器的域名，我的是www.hrw1rdzqa7c5a8u3ibkn.website</li><li>路径：即前面的随机字符串，注意前面必须要加上斜杠“/”，这里的例子是/mL7Gg8K</li><li>底层传输安全：选tls</li></ul><br>\n配置完成后如下图:<br>\n<a href=\"https://i.imgur.com/rYmRD6S.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/rYmRD6S.png\" alt=\"https://i.imgur.com/rYmRD6S.png\" style=\"max-width:100%\"></a><br>\n<center>【fig5.1.2】</center><br>\n<br>\n<center><b>5.2 Android客户端</b></center><br>\n安卓客户端推荐V2RayNG，配置和V2RayN可以互通。下载地址：<br>\n<a href=\"https://github.com/2dust/v2rayNG/releases\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">https://github.com/2dust/v2rayNG/releases</a><br>\n<br>\n分享配置很简单，在Windows的V2RayN客户端里，点击服务器列表，勾选右边的“显示分享内容”，可以显示配置的二维码。安卓端选择“扫描二维码”导入配置即可。<br>\n<br>\n<center><b>5.3 iOS客户端</b></center><br>\niOS客户端全部要收费，常用有Shadowrocket（小火箭）等。配置方法略。<br>\n<br>\n其它平台客户端（Mac OS，Linux）可以查看V2Ray官网的客户端列表：<a href=\"https://v2ray.com/awesome/tools.html\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">神一样的工具们</a><br>\n<b><br>\n到这一步结束，整个V2Ray翻墙的搭建就结束了。接下来是一些可选配置，可以加强你的服务器的隐蔽性和安全性。</b><br>\n<br>\n<center><b>可选配置1：使用CDN隐藏IP</b></center><br>\nCDN相当于在服务器前又加了一层代理，墙只知道你的域名和CDN的IP，无法得知代理服务器的真实IP。如果伪装网站开启了DoH+ESNI，甚至连域名都可以隐藏。因此v2ray+ws+tls+web+CDN相当于事实上的双重代理，它的隐蔽性和安全性非常高。缺点是Cloudflare 会让访问延迟变高一些。除非遇到IP被墙，或者六四前后等墙加高等极端情况，如果平时翻墙很稳定，就没有必要打开CDN。<br>\n<br>\n因为前面已经注册了Cloudflare解析，所以使用CDN非常简单，只要两步即可。<br>\n<br>\n<b>(1) </b>登录Cloudflare账号，点击【DNS】按钮，进入Cloudflare的管理页面，如图：<br>\n<a href=\"https://i.imgur.com/ihzyMBe.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/ihzyMBe.png\" alt=\"https://i.imgur.com/ihzyMBe.png\" style=\"max-width:100%\"></a><br>\n<center>【figb.1】</center><br>\n点一下灰色的云，让颜色变成橙色即可。<br>\n<br>\n点击切换后，域名不会马上解析到CDN的地址，一般会有几分钟的延迟。可以ping一下你的服务器的域名，如果返回地址是CDN的IP，就说明切换完成。<br>\n<br>\n<b>(2.1) 使用自动选择的CDN IP地址</b><br>\n接下来配置客户端。客户端切换成CDN很简单，配置的其它地方不用改动，只要把地址一栏换成域名即可，如图<br>\n<a href=\"https://i.imgur.com/1MsBKA0.png\" rel=\"nofollow noreferrer noopener\" target=\"_blank\"><img src=\"https://i.imgur.com/1MsBKA0.png\" alt=\"https://i.imgur.com/1MsBKA0.png\" style=\"max-width:100%\"></a><br>\n<center>【figb.2】</center><br>\n手机端配置方法类似，把IP换成网址即可。<br>\n<br>\n<b>(2.2) 手动指定CDN IP地址</b><br>\n(2.1)节介绍的方法可以满足大多数人的需要，事实上要连接的CDN节点也可以手动指定。手动指定CDN节点地址，可以免费使用不同运行商的线路和不同国家的入口节点。如果自动分配的CDN节点速度不理想，可以尝试手动指定入口节点。<br>\n<br>\n配置方法也非常简单：在第(1)节把云朵点成橙色之后，在V2RayN的【地址】一栏里，不填入网址，而是填入CDN的IP地址。<br>\n举例如下：<br>\n<ul><li>电信线路+美国旧金山节点：172.64.0.8</li><li>联通线路+日本节点：104.20.157.84</li><li>移动线路+新加坡节点：104.28.14.8</li></ul><br>\n上述IP是属于Cloudflare的公共地址，所以不会被封。Cloudflare提供了非常多的地区+线路组合，具体可参加网友@marxist 的贴子：<br>\n《<a href=\"https://pincong.rocks/question/25479\">关于国产输入法的隐私问题以及如何选择合适的cloudflare IP地址？</a>》<br>\n原贴见：<a href=\"https://ofvps.com/201907510\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">https://ofvps.com/201907510</a><br>\n<br>\n<center><b>可选配置2：加固服务器，配置防火墙</b></center><br>\n如果VPS上没有其它服务，建议打开防火墙。服务器对外只暴露80，443，SSH端口，可以降低代理服务器被探测的风险。<br>\n<br>\n前面的步骤中禁用了防火墙firewalld，不是所有的机器都安装了firewalld，我们这里使用ufw防火墙作为替代。<br>\n<br>\n安装ufw：<br>\n<pre>yum install -y epel-release &amp;&amp; yum install -y ufw</pre><br>\n打开SSH，HTTP，HTTPS端口，运行：<br>\n<pre>ufw disable &amp;&amp; ufw allow ssh &amp;&amp; ufw allow http &amp;&amp; ufw allow https &amp;&amp; ufw enable</pre><br>\n如果ssh端口不是22，那么需要将ssh改为端口号。例如ssh端口为14320，则：<br>\n<pre>ufw disable &amp;&amp; ufw allow 14320 &amp;&amp; ufw allow http &amp;&amp; ufw allow https &amp;&amp; ufw enable</pre><br>\nufw和firewalld的底层实现都是一样的，都调用了linux iptables，本质并无太大区别。<br>\n<br>\n<center><b>可选配置3：使用BBR加速</b></center><br>\nBBR是谷歌开发的拥塞控制算法，可以降低延迟，加快访问速度。启用BBR需要4.10以上版本Linux内核，现在大多数VPS都满足这一条件，输入uname(空格)-a可以查看内核版本.<br>\n如果内核版本大于4.10就可以用BBR了，把以下三条命令复制到命令窗口执行：<br>\n<pre>bash -c 'echo \"net.core.default_qdisc=fq\" &gt;&gt; /etc/sysctl.conf'<br>\nbash -c 'echo \"net.ipv4.tcp_congestion_control=bbr\" &gt;&gt; /etc/sysctl.conf'<br>\nsysctl -p</pre><br>\n然后运行以下命令，查看BBR是否启动成功：<br>\n<pre>sysctl net.ipv4.tcp_congestion_control</pre><br>\n如果提示<br>\n<pre>net.ipv4.tcp_congestion_control = bbr</pre><br>\n就表示成功启动了BBR加速。<br>\n<br>\n<center><b>可选配置4：编译Nginx</b></center><br>\n<b>**本节内容需要有一定Linux基础**</b><br>\n<br>\n某些系统上，通过yum安装的Nginx不支持TLS1.3，需要自行编译。启用TLS1.3可以明显降低VMess+WS+TLS的延迟（握手1-RTT，恢复会话0-RTT）。此外，TLS1.3第一个RTT之后的握手包均被加密，（可能）会降低TLS协议的指纹特征。<br>\n<br>\nCaddy（另一个HTTP反向代理软件）也支持TLS1.3，但自行配置和编译的Nginx可以通过调整多种参数，达到更高的性能。自行编译Nginx也可以启用一些其它反向代理中的特征，例如HTTP/2等。<br>\n<br>\nNginx编译安装步骤：<br>\n<br>\n更新所有软件及系统内核（用时较长，可选）：<br>\n<pre><br>\nyum -y update<br>\n</pre><br>\n安装依赖软件和库：<br>\n<pre><br>\nyum -y install wget gcc make perl pcre pcre-devel zlib zlib-devel<br>\n</pre><br>\n下载OpenSSL 1.1.1g（截至2020年4月21日的最新版）<br>\n<pre><br>\nwget https://github.com/openssl/openssl/archive/OpenSSL_1_1_1g.zip<br>\nunzip OpenSSL_1_1_1g.zip<br>\nrm OpenSSL_1_1_1g.zip &amp;&amp; mv openssl-OpenSSL_1_1_1g openssl<br>\n</pre><br>\n下载Nginx 1.18.0（截至2020年4月21日的最新版）<br>\n<pre><br>\nwget https://nginx.org/download/nginx-1.18.0.tar.gz<br>\ntar -xzvf nginx-1.18.0.tar.gz<br>\ncd nginx-1.18.0<br>\n</pre><br>\n配置编译选项<br>\n<pre><br>\n./configure --with-openssl=../openssl --with-openssl-opt='enable-tls1_3' --with-http_v2_module --with-http_ssl_module --with-http_gzip_static_module<br>\n</pre><br>\n这一步是Nginx启用TLS1.3的关键，--with-openssl-opt='enable-tls1_3'表示启用TLS1.3，--with-http_v2_module表示启用HTTP/2<br>\n<br>\n编译&amp;安装<br>\n<pre><br>\nmake &amp;&amp; make install<br>\n</pre><br>\n编译完成的Nginx二进制文件位置在/usr/local/nginx/sbin/nginx，可用以下命令进行测试：<br>\n<pre><br>\n/usr/local/nginx/sbin/nginx -V<br>\n</pre><br>\n与此对应的，Nginx配置文件目录和网页文件目录分别在：<br>\n<pre><br>\n/usr/local/nginx/conf<br>\n/usr/local/nginx/html<br>\n</pre><br>\n为了把Nginx配置成系统服务，还需要配置systemd文件：<br>\n<pre><br>\n[Unit]<br>\nAfter=syslog.target network.target remote-fs.target nss-lookup.target<br>\n<br>\n[Service]<br>\nType=forking<br>\nPIDFile=/usr/local/nginx/logs/nginx.pid<br>\nExecStartPre=/usr/local/nginx/sbin/nginx -t<br>\nExecStart=/usr/local/nginx/sbin/nginx<br>\nExecReload=/bin/kill -s HUP $MAINPID<br>\nExecStop=/bin/kill -s QUIT $MAINPID<br>\nPrivateTmp=true<br>\n<br>\n[Install]<br>\nWantedBy=multi-user.target<br>\n</pre><br>\n最后把上述文件命名为nginx.service，放在/etc/systemd/system下，就完成了Nginx的编译安装。<br>\n<br>\n--<br>\n到这里，整个V2Ray翻墙教程就结束了，过程总结：<br>\n<ol><li>购买域名 &amp; 配置域名解析</li><li>安装Nginx和V2Ray</li><li>上传配置文件</li></ol><br>\n<br>\n可选步骤：<br>\n<ul><li>CDN隐藏IP</li><li>打开防火墙</li><li>BBR加速</li><li>编译Nginx</li></ul>","date":"2020-03-02","agreeCount":180,"discussionCount":0}