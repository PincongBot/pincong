{"type":"article","id":1362,"title":"another pincong blackList 正则表达式与屏蔽按钮","uid":4719,"topics":[118],"contents":"<a href=\"https://pincong.rocks/article/1358\">原始 连接</a><br>\n油猴脚本，用正则表达式过滤不想看到的用户的回答，文章评论和首页提问，首页文章；并自动修正回答与评论数量。<br>\n<br>\n至于问题下面的评论，我认为不该隐藏，一般都是有回复的，而且在你打开评论前，不知道里面到底有多少个不应过滤的评论，想象一下你打开一个评论，然后发现是空的。<br>\n<br>\n<pre><br>\n// ==UserScript==<br>\n// @name&nbsp; &nbsp; &nbsp; &nbsp; PincongBlackList<br>\n// @match&nbsp; &nbsp; &nbsp;&nbsp; pincong.rocks/*<br>\n// @grant&nbsp; &nbsp; &nbsp;&nbsp; GM_setValue<br>\n// @grant&nbsp; &nbsp; &nbsp;&nbsp; GM_getValue<br>\n// @noframes<br>\n// @run-at&nbsp; &nbsp; &nbsp; document-body<br>\n// ==/UserScript==<br>\n(function (l, id) {<br>\n&nbsp; &nbsp; id = id.concat(GM_getValue('blackList', []));<br>\n&nbsp; &nbsp; let $ = document.querySelectorAll.bind(document);<br>\n&nbsp; &nbsp; let $$ = document.querySelector.bind(document);<br>\n&nbsp; &nbsp; let inReg = (s, l) =&gt; l.some(v =&gt; v.test(s));<br>\n&nbsp; &nbsp; let inId = (s, l) =&gt; l.includes(s);<br>\n&nbsp; &nbsp; // 仅当不在首页时, 屏蔽文章评论 or 回答<br>\n&nbsp; &nbsp; for (let i of $('.aw-user-img')) {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let p = i.closest('.aw-item')<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if (inReg(decodeURIComponent(i.href.split('/')[4]), l) ||<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inId(i.getAttribute('data-id'), id);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; ) {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.style.display = &quot;none&quot;;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let xs = $$(&quot;.mod-head h2&quot;);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; xs.textContent = parseInt(xs.textContent) - 1 + xs.textContent.slice(-3);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; &nbsp; &nbsp; //增加屏蔽按钮<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let name = p.querySelector('.aw-user-name');<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let btn = document.createElement('a');<br>\n&nbsp; &nbsp; &nbsp; &nbsp; btn.innerText = '屏蔽';<br>\n&nbsp; &nbsp; &nbsp; &nbsp; btn.style.float = &quot;right&quot;;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; btn.style.color = &quot;white&quot;;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; btn.onmouseover = function () { this.style.color = &quot;black&quot; };<br>\n&nbsp; &nbsp; &nbsp; &nbsp; btn.onmouseout = function () { this.style.color = &quot;white&quot; };<br>\n&nbsp; &nbsp; &nbsp; &nbsp; btn.onmousedown = function () {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (confirm('确认屏蔽？')) {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var z = GM_getValue('blackList', []);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z.push(name.getAttribute('data-id'));<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GM_setValue('blackList', z);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p.style.display = &quot;none&quot;;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; &nbsp; &nbsp; name.after(btn);<br>\n&nbsp; &nbsp; }<br>\n&nbsp; &nbsp; // 仅当在首页时, 屏蔽发表的文章 or 发起的问题<br>\n&nbsp; &nbsp; for (let i of $('.aw-item&gt;a')) {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if (<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inReg(decodeURIComponent(i.href.split('/')[4]), l) ||<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; inId(i.getAttribute('data-id'), id)<br>\n&nbsp; &nbsp; &nbsp; &nbsp; ) {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i.parentNode.style.display = &quot;none&quot;;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; }<br>\n})(<br>\n[/用爱心说诚实话/, /^支那/, /支字头/],<br>\n[&quot;3700&quot;, &quot;3700&quot;]);<br>\n<br>\nfunction setBlackList() {<br>\n&nbsp; &nbsp; let userInput = prompt(&quot;黑名单\\<br>\n&quot; + GM_getValue('blackList', []) + &quot;\\<br>\n更改为&quot;);<br>\n&nbsp; &nbsp; if (userInput != null) {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let bl = [];<br>\n&nbsp; &nbsp; &nbsp; &nbsp; for (let i of userInput.split(',')) {<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bl.push(i);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; &nbsp; &nbsp; GM_setValue('blackList', bl);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; alert(&quot;更改后的黑名单\\<br>\n&quot; + +GM_getValue('blackList', []));<br>\n&nbsp; &nbsp; }<br>\n}<br>\n// setBlackList() //手动设置黑名单<br>\n</pre><br>\n<br>\n<pre><br>\n[/用爱心说诚实话/, /^支那/, /支字头/],<br>\n[&quot;3700&quot;, &quot;3700&quot;])<br>\n</pre><br>\n其中在这两列中可以手动设置屏蔽哪些人<br>\n同时在回答的右上角增加了屏蔽按钮，按下即可永久屏蔽此人<br>\n<pre><br>\n// setBlackList() //手动设置黑名单<br>\n</pre><br>\n把这行取消注释可以查看并修改已经存在数据库中的黑名单<br>\n比如输入<br>\n<pre><br>\n3700, 3701, 3702<br>\n</pre>","date":"2019-04-26","agreeCount":1,"discussionCount":0}