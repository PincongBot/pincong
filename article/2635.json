{"type":"article","id":2635,"title":"【High Priority】封禁/解封日志","uid":8132,"topics":[],"contents":"<a href=\"https://github.com/orgs/pin-cong/teams/pincong-developer-committee/discussions/13\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">Original_Link</a><br>\n<b><i>This discussion concerns the function \"封禁/解封日志\", for any discussion related to this, please follow up under this thread.</i></b><br>\n<b>The whole discussion was written in English for developers convenience. For Chinese accessibility, please use&nbsp;<a href=\"https://translate.google.com/\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">Google translate</a>.</b><br>\n<s>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</s><br>\n<b>中文描述：封禁和解封没有日志，需要添加封禁和解封公示。</b><br>\n<s>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</s><br>\n<b>Before starting</b>:<br>\n<ol><li>Read&nbsp;<u>forbid_user_by_uid</u><i>()</i>&nbsp;function in \"<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/models/account.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/models/account.php</a>\", understand how forbidding and unforbidding a user works. Note the $status argument: when <pre>$status!=0</pre>, the user is forbidden, and when <pre>$status=0</pre>, the user is unforbidden. This corresponds to the status column in table aws_users. Current $status codes are:<ul><li>0: Normal</li><li>1: Permanently banned, but would not delete (can only be done by backend admin, example:&nbsp;<a href=\"https://pincong.rocks/people/%E5%A4%A9%E7%A5%9E%E4%B9%9D%E9%A0%AD%E9%B3%A5\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">@天神九頭鳥</a>)</li><li>2: Banned due to low reputation (obsolete, example:&nbsp;<a href=\"https://pincong.rocks/people/%E6%AD%A4%E7%94%9F%E6%97%A0%E6%82%94%E5%85%A5%E5%8D%8E%E5%A4%8F\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">@此生无悔入华夏</a>)</li><li>3: Permanently banned, and will delete the account 7 days after banned (default when user's reputation is less than 5, with current setting).</li><li>4: Temporarily banned, and will unban after the <i>days_unforbid_users</i> days in <i>aws_setting</i>. The current setting is 1 day. This number can only be changed by backend admins for now. Banning those with reputation &gt; 5 will go into this status. Note the <i>banned_by</i> and <i>banned_reason</i> keys.</li></ul></li><li>Read <u>log_action</u>() and <u>list_logs_action</u>() functions in\"<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/app/content/main.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/app/content/main.php</a>\", see how logs for changing the content (e.g. 编辑、删除、变更分类 etc.) are listed.</li><li>Read \"<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/views/default/content/log.tpl.htm\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/views/default/content/log.tpl.htm</a>\" and \"<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/views/default/content/list_logs_template.tpl.htm\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/views/default/content/list_logs_template.tpl.htm</a>\", see how frontend displyas the changing logs for content. Note that&nbsp;<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/views/default/content/log.tpl.htm\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">log.tpl.htm</a>&nbsp;is for the initial display and&nbsp;<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/views/default/content/list_logs_template.tpl.htm\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">list_logs_template.tpl.htm</a>&nbsp;is for \"更多\" option (listing more).</li></ol><br>\n<s>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</s><br>\n<b>TODO List (Database Table):</b><br>\nAdd a table named <i>aws_banlog</i>, with columns <i>uid</i>, <i>status</i>, <i>banned_by</i>, <i>reason</i>, <i>time</i>.<br>\n<ul><li>uid: The uid of the user being banned.</li><li>status: The status of banning. See above for a description.</li><li>banned_by: The uid of the admin who banned the user.</li><li>reason: Banned reason.</li><li>time: The time of the operation.</li></ul><br>\n<s>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</s><br>\n<b>TODO List (PHP Code):</b><br>\n[<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/models/account.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/models/account.php</a>]<br>\n<ul>Edit function <u>forbid_user_by_uid()</u> to include the banning and unbanning log by INSERT operation.</ul><br>\n[<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/app/people/main.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/app/people/main.php</a>]<br>\n<ul>Add functions <u>log_action()</u> and <u>list_logs_action()</u>, similar to that for changing the content. But this is easier because we don't need any item_type or item_id. Don't forget to add the actions to get_access_rule(), and output the template for listing banning logs (see below).</ul><br>\n<s>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</s><br>\n<b>TODO List (HTML/JS Code):</b><br>\n<u>[pincong-wecenter-master/views/default/people/log.tpl.htm]</u><br>\n<ol>Create a template for listing the banning and unbanning log, similar to that of changing logs. You need to list the banned user, status, reason and time (or unbanned user and time).</ol><br>\n<u>[pincong-wecenter-master/views/default/people/list_logs_template.tpl.htm]</u><br>\n<ul>See above.</ul><br>\n<s>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</s><br>\n<br>\nPlease post any question you may have. We probably will encouter more issues while editing. Don't hesitate to follow up your problems. Thanks and happy coding!","date":"2019-07-28","agreeCount":7,"discussionCount":0}