{"type":"article","id":19299,"title":"【霏艺所思】什么是闭包？","uid":18160,"topics":[9007],"contents":"Q：什么是闭包？<br>\nA：一种内部函数，用来访问内部变量。<br>\n<br>\n这里注意到两个关键点：<br>\n1.它是一个函数<br>\n2.用途是访问内部变量<br>\n<br>\nQ：为什么要使用闭包？<br>\nA：Javascript 类语言没有提供 C语言的引用功能。。。<br>\n<br>\n开始本文的重点！<br>\nC/C++/Rust这些<b>裸金属语言</b>，支持一种叫引用的操作。<br>\n记作 int &amp;a = b;&nbsp; <br>\n但是js这些语言不支持啊！就搞一个“闭包”来实现类似的功能，然后掩盖自己的缺陷。。。<br>\n<br>\njs的缺陷，函数调用<b>只能传值，不能传引用</b>。每次调用函数，<b>会创建一个新的作用域</b>。<br>\n上层作用域，无法感知下层作用域。C语言可以在<b>上层作用域创建内存</b>，通过<b>引用</b>来传给下层，下层去操作上层创建的内存就可以了。那么js是先天不足。。。。<br>\n<br>\n有人会说，不能传引用，传值不行么？<br>\n当然不行！很多问题：<br>\n1.调用函数的时候，函数内部操作完修改了变量是内部的作用域的拷贝，外层内存没有变化<br>\n2.浪费了内存<br>\n其实就是C语言语法的基础。。。<br>\n得明白为什么C语言要搞引用<br>\n<br>\n明白了么？<br>\n闭包是为了解决某些语言不支持“引用”特性，自己给自己找台阶下的一个语法而已。。。<br>\n引用是为了省内存。闭包达到了类似的效果，但是性能开销却很大。。。少用！<br>\n<br>\n----------------------------------------------<br>\n本文章时间来不及，日后补充<br>\n<br>\n进入本文的重点章节，跨语言编程！【比如C++ 和 Python】<br>\n我写AI的代码，从python侧调用C++的函数，可以通过pybind<br>\n但是如果要操作内存怎么办？<br>\n因为不支持<b>传递引用</b>，所以我就传闭包给C++[所以你们看AI相关的代码，经常在C++侧看到闭包]<br>\n当然有更加Native的方法，就是传c++的指针给python<br>\n【不管是传闭包，还是传指针，我来不及写了，下次补上】<br>\n<br>\n----------------------------------------------<br>\n本文章时间来不及，日后补充<br>\n<br>\n进入本文的第二个重点章节，右值引用，完美转发！<br>\n作为裸金属语言，C++对性能的敲诈【应该是压榨】可谓丧心病狂~<br>\n上面那么多铺垫，是为了让你们明白什么叫引用，以及引用的好处<br>\n这样，你们才能明白，我接下来要说的东西","date":"2020-05-23","agreeCount":8,"discussionCount":0}