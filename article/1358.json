{"type":"article","id":1358,"title":"PincongFilter","uid":920,"topics":[118],"contents":"不正经的简介：<br>\n你有说话放屁的自由，我就有掩耳捂鼻的权力。<br>\n<br>\n<br>\n<br>\n正经的简介：<br>\n过滤来自特定id的问题、文章、回答及评论，对匿名用户无效。<br>\n同时对于未被过滤的非匿名用户，在其用户名或头像旁显示该用户的id。<br>\n目前只能通过修改代码中特定变量的方法添加所需过滤的id。<br>\n<br>\n本来打算放在pastebin的，想想还是算了……<br>\n不接受来自浏览器兼容性的bug report。<br>\n<br>\n20190430更新：<br>\n过滤文章的评论。<br>\n修复额外的显示用户id的行为。<br>\n<br>\n<br>\n<s>P.S. 但是无法过滤文章的评论，因为这些评论的用户信息都没有data-id。这个要看网站后台的心情了。</s> 已修复<br>\nP.S. 当然网站后台想要封杀这个脚本也非常容易。这个也看网站后台的心情了。<br>\n<br>\n<pre><br>\n// ==UserScript==<br>\n// @name&nbsp; &nbsp; &nbsp; &nbsp; PincongFilter<br>\n// @namespace&nbsp;  PincongFilter<br>\n// @match&nbsp; &nbsp; &nbsp;  https://pincong.rocks/*<br>\n// @version&nbsp; &nbsp;  1<br>\n// @grant&nbsp; &nbsp; &nbsp;  none<br>\n// @run-at&nbsp; &nbsp; &nbsp; document-start<br>\n// ==/UserScript==<br>\n<br>\n(function(){<br>\n&nbsp; &nbsp; let doc=document;<br>\n&nbsp; &nbsp; let html=doc.documentElement;<br>\n&nbsp; &nbsp; let map=function(f,i){for(let n of i)f(n);}<br>\n&nbsp; &nbsp; let newtag=function(t){return doc.createElement(t);}<br>\n&nbsp; &nbsp; let newtext=function(s){return doc.createTextNode(s);}<br>\n&nbsp; &nbsp; let addev=function(n,e,f){return n.addEventListener(e,f);}<br>\n&nbsp; &nbsp; let selid=function(i){return doc.getElementById(i);}<br>\n&nbsp; &nbsp; let seltag=function(t){return doc.getElementsByTagName(t);}<br>\n&nbsp; &nbsp; let selcss=function(c,r){return (r?r:doc).querySelectorAll(c);}<br>\n&nbsp; &nbsp; let selcss1=function(c,r){return (r?r:doc).querySelector(c);}<br>\n&nbsp; &nbsp; let hasattr=function(n,a){return n.hasAttribute(a);}<br>\n&nbsp; &nbsp; let getattr=function(n,a){return n.getAttribute(a);}<br>\n&nbsp; &nbsp; let setattr=function(n,a,v){n.setAttribute(a,v);}<br>\n&nbsp; &nbsp; let delattr=function(n,a){if(hasattr(n,a))n.removeAttribute(a);}<br>\n&nbsp; &nbsp; let appendnode=function(r,n){n?r.appendChild(n):null;}<br>\n&nbsp; &nbsp; let delnode=function(n){n?n.remove():null;}<br>\n<br>\n&nbsp; &nbsp; let watch=function(n,p,f){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let config={};<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let leastprops=['childList','attributes','characterData'];<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let validconfig=false;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let watcher=new MutationObserver(f);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; map(n=&gt;config[n]=true,p);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; for(let prop of leastprops)<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; validconfig=validconfig||config[prop];<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if(!validconfig)config[leastprops[0]]=true;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; watcher.observe(n,config);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; addev(window,'beforeunload',()=&gt;watcher.disconnect());<br>\n&nbsp; &nbsp; }<br>\n<br>\n&nbsp; &nbsp; let hiddenstart=function(r,f){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; r.hidden=true;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; addev(doc,'DOMContentLoaded',()=&gt;{f();r.hidden=false;});<br>\n&nbsp; &nbsp; }<br>\n<br>\n<br>\n<br>\n<br>\n&nbsp; &nbsp; // blacklist of userid, quoted as string<br>\n&nbsp; &nbsp; let blacklist=[]<br>\n<br>\n<br>\n&nbsp; &nbsp; // question or article<br>\n&nbsp; &nbsp; let question_selector='div.aw-common-list&gt;div.aw-item';<br>\n&nbsp; &nbsp; // answer for question or comment for article<br>\n&nbsp; &nbsp; let answer_selector='div.aw-item[id^=&quot;answer_list_&quot;]';<br>\n&nbsp; &nbsp; // comment for answer or comment<br>\n&nbsp; &nbsp; let comment_selector='div.aw-comment-box&gt;div.aw-comment-list&gt;ul&gt;li';<br>\n&nbsp; &nbsp; // prefix of user path<br>\n&nbsp; &nbsp; let user_prefix='/people/';<br>\n&nbsp; &nbsp; // search path of user<br>\n&nbsp; &nbsp; let user_search='https://pincong.rocks/search/ajax/search/?type=users&amp;limit=1&amp;q='<br>\n<br>\n&nbsp; &nbsp; let counter=0;<br>\n<br>\n&nbsp; &nbsp; let filter_answer=function(node){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let usernode=selcss1('div.mod-head a.aw-user-name[data-id]',node);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; // only do on non-anonymous user<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if(usernode){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let userid=getattr(usernode,'data-id');<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if(blacklist.includes(userid)){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.debug('filter answer:',usernode.textContent);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; counter+=1;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delnode(node);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; usernode.textContent+=' ('+userid+')';<br>\n&nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; &nbsp; &nbsp; watch(node,['subtree'],commentfilter);<br>\n&nbsp; &nbsp; }<br>\n<br>\n&nbsp; &nbsp; let filter_question=function(node){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let usernode=selcss1('a.aw-user-name[data-id]:first-child',node);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; // anonymous user, do nothing<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if(!usernode)return;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let userid=getattr(usernode,'data-id');<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if(blacklist.includes(userid)){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.debug('filter question:',userid);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; counter+=1;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delnode(node);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; &nbsp; &nbsp; // anonymous user, do nothing<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if(userid.length===0)return;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let p=newtag('p');<br>\n&nbsp; &nbsp; &nbsp; &nbsp; appendnode(p,newtext(userid));<br>\n&nbsp; &nbsp; &nbsp; &nbsp; appendnode(usernode,p);<br>\n&nbsp; &nbsp; }<br>\n<br>\n&nbsp; &nbsp; let filter_comment=function(node){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let usernode=selcss1('a.aw-user-name.author[data-id]:not([data--])',node);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; // anonymous user, do nothing<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if(!usernode)return;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; let userid=getattr(usernode,'data-id');<br>\n&nbsp; &nbsp; &nbsp; &nbsp; if(blacklist.includes(userid)){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.debug('filter comment:',usernode.textContent);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; counter+=1;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delnode(node);<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return;<br>\n&nbsp; &nbsp; &nbsp; &nbsp; }<br>\n&nbsp; &nbsp; &nbsp; &nbsp; usernode.textContent+=' ('+userid+')';<br>\n&nbsp; &nbsp; &nbsp; &nbsp; setattr(usernode,'data--','');<br>\n&nbsp; &nbsp; }<br>\n<br>\n&nbsp; &nbsp; let commentfilter=function(){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; map(filter_comment,selcss(comment_selector))<br>\n&nbsp; &nbsp; }<br>\n<br>\n&nbsp; &nbsp; let mainfilter=function(){<br>\n&nbsp; &nbsp; &nbsp; &nbsp; map(filter_answer,selcss(answer_selector));<br>\n&nbsp; &nbsp; &nbsp; &nbsp; map(filter_question,selcss(question_selector));<br>\n&nbsp; &nbsp; }<br>\n<br>\n&nbsp; &nbsp; hiddenstart(html,mainfilter);<br>\n})()<br>\n</pre>","date":"2019-04-26","agreeCount":7,"discussionCount":0}