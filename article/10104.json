{"type":"article","id":10104,"title":"【安全漏洞】品葱存在安全漏洞 第二弹","uid":14014,"topics":[199,6595],"contents":"<b>漏洞影响</b><br>\n<br>\n攻击者可以构造品葱链接造成任意URL跳转，攻击者可以让毫无防备的品葱用户<b>跳转到任意网站</b>，而没有任何警告<br>\n<br>\n<b>漏洞POC</b><br>\n<br>\n链接：<a href=\"https://pincong.rocks/account/main/login/&amp;url=aHR0cHM6Ly9nb29nbGUuY29t\">https://pincong.rocks/account/main/login/&amp;url=aHR0cHM6Ly9nb29nbGUuY29t</a><br>\n<br>\n描述：用户点击后会在无提示的情况下跳转至Google<br>\n<br>\n<b>漏洞位置</b><br>\n<br>\n在品葱源码 app/account/main.php的login_action函数中存在问题<br>\n<br>\n<pre>&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;login_action()<br>\n&nbsp;&nbsp;&nbsp;&nbsp;{<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;base64_decode($_GET['url']);<br>\n<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($this-&gt;user_id)<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($url)<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header('Location:&nbsp;'&nbsp;.&nbsp;$url);<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTTP::redirect('/');<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</pre><br>\n在该函数中$url变量从$_GET参数中直接Base64解码获取而没有过滤，在验证用户登录后直接跳转<br>\n<br>\n<b>修复措施/防御建议</b><br>\n<br>\n验证URL是否属于品葱信任地址或者直接删除该功能<br>\n由于这两个发现的漏洞属中低危漏洞，本人直接将其公开，如果发现有高危漏洞将会考虑使用其它方式联系管理员<br>\n<br>\n<b>最后</b><br>\n<br>\n希望我们能撑到每个人都能摘下面具的那一天","date":"2019-12-03","agreeCount":6,"discussionCount":0}