{"type":"article","id":2638,"title":"【High Priority】评论/回答折叠功能","uid":8132,"topics":[1923],"contents":"<a href=\"https://github.com/orgs/pin-cong/teams/pincong-developer-committee/discussions/4\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">Original_Link</a><br>\n<b><i>This discussion concerns the function &quot;评论/回答折叠&quot;, for any discussion related to this, please follow up under this thread.</i></b><br>\n<b>The whole discussion was written in English for developers convenience. For Chinese accessibility, please use&nbsp;<a href=\"https://translate.google.com/\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">Google translate</a>.</b><br>\n最高优先级，本功能为保证良好讨论质量，防止谩骂刷屏和五毛带节奏，应尽快写出。希望大家多多重视，有能力者积极参与，谢谢！<br>\n[s]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[/s]<br>\n<b>中文描述：目前只有被封用户和踩大于5的回复才会折叠，管理员无权折叠，本功能为实现管理折叠</b><br>\n[s]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[/s]<br>\n<b>Before starting</b>:<br>\n<ol><br>\n<li>Read &quot;<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/models/answer.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/models/answer.php</a>&quot; (or &quot;<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/models/article.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">article.php</a>&quot;, or &quot;<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/models/video.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">video.php</a>&quot;), search for keyword&nbsp;word&nbsp;<i>['fold']，&nbsp;</i>and see how folding an answer/comment works on the backend.</li><br>\n<li>Read &quot;<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/views/default/article/index.tpl.htm\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/views/default/article/index.tql.htm</a>&quot; (for example), search for keyword&nbsp;<i>['fold']</i>, and see how folding works on the frontend</li><br>\n<li>Look at&nbsp;<u>why_fold()&nbsp;</u>function in &quot;<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/static/js/aws.js\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/static/js/aws.js</a>&quot;.</li><br>\n</ol><br>\n[s]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[/s]<br>\n<b>TODO List Summary:</b><br>\n<ol><br>\n<li>Add a new table, recording all folding type (i.e, whether it's an answer, a comment etc.), folding item_id, and folding reason (better to&nbsp;<i>&lt;select&gt;</i>&nbsp;be a&nbsp;tag) and the id of the folding admin.<br>\n<ul><br>\n<li>Current code in use:</li><br>\n1: 账号被封禁</ul><br>\n<ul><br>\n2: 踩数过多没有帮助<br>\n<li>Hypothetical code:</li><br>\n3: 无关回答/评论</ul><br>\n<ul><br>\n4: 谩骂、侮辱</ul><br>\n<ul><br>\n5: 刷屏、扰乱秩序</ul><br>\n</li><br>\n<li>Add a new ajax function for submitting folding request.</li><br>\n<li>Add folding reason (the number) to the item.</li><br>\n<li>Modify&nbsp;<u>why_fold()</u>function to show the folding reason.</li><br>\n</ol><br>\n[s]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[/s]<br>\n<b>TODO List (Database Table):</b><br>\nCreate a new table, named &quot;aws_folding&quot;, with columns: item_id, type, reason, operator_id.<br>\n<ul><br>\n<li>item_id: The item id, could be either answer id or comment id.</li><br>\n<li>type: It indicates which type the id refers to (e.g., &quot;answer&quot; or &quot;article&quot;).</li><br>\n<li>reason: The reason why it is folded,&nbsp;<b>we probably might open an RFC to discuss the reasons, but for now please use the hypothetical reasons listed above</b>. They will be numbers listed in&nbsp;<i>&lt;select&gt;&nbsp;</i>tag on the frontend.</li><br>\n<li>operator_id: The admin id who has folded the answer/comment.</li><br>\n</ul><br>\n[s]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[/s]<br>\n<b>TODO List (PHP Code):</b><br>\n[<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/app/article/ajax.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/app/article/ajax.php</a>]<br>\n<ol><br>\n<li>Add new rule &quot;fold_comment&quot; in function <u>get_access_rule</u>().</li><br>\n<li>Add a new ajax function <u>fold_comment_action</u>() following the regular ajax rule, use <br>\n<pre>model(&quot;article&quot;)-&gt;fold_comment()</pre><br>\n</li><br>\n</ol><br>\n[[url=https://github.com/pincong/pincong-wecenter/blob/master/app/people/main.php][/url]<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/models/article.php\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/models/article.php</a>]<br>\n<ol><br>\n<li>Edit function <u>get_comment_by_id</u>() and <u>get_comments</u>() to set the right <i>['fold']</i> attributes (i.e., the folding reason from the table).</li><br>\n<li>Add a new function <u>fold_comment</u>() with proper arguements and database operations.</li><br>\n</ol><br>\n[s]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[/s]<br>\n<b>TODO List (HTML/JS Code):</b><br>\n<b>For simplicty, we only described the procedure for article. Should be the same for answer and vidoe comment</b><br>\n[<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/views/default/article/index.tpl.htm\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/views/default/article/index.tql.htm</a>]<br>\n<ol><br>\n<li>Add the <i>['fold']</i> id to function <u>AWS.User.why_fold</u>().</li><br>\n<li>Add an ajax button for folding request.</li><br>\n</ol><br>\n<u>[<a href=\"https://github.com/pincong/pincong-wecenter/blob/master/static/js/aws.js\" rel=\"nofollow noreferrer noopener\" target=\"_blank\">pincong-wecenter-master/static/js/aws.js</a>]</u><br>\n<ol><br>\n<li>Edit the function <u>why_fold</u>() to display the folding reason correctly.</li><br>\n<li>Add a new function <u>fold_comment</u> with the right UI, please see function <u>forbid_user</u> for refrence. Change the <i>textBox</i> to <i>dropDown</i>.</li><br>\n</ol><br>\n[s]&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[/s]<br>\nPlease post any question you may have. We probably will encouter more issues while editing. Don't hesitate to follow up your problems. Thanks and happy coding!","date":"2019-07-27","agreeCount":1,"discussionCount":0}