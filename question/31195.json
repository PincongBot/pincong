{"type":"question","id":31195,"title":"如何优化这段搬运图片的Python代码？","uid":36028,"topics":[2584,10827,10828,2697,6028],"contents":"代码是抄网上后魔改的，如何优化正则表达所在的那行代码？<br>\n顺代一提正在用Python汇总翻车新闻和微博谈到一个文件里，自己边学边写。<br>\n也请教下品葱的大佬。<br>\n<pre>import re<br>\nimport time<br>\nfrom base64 import b64encode<br>\nfrom pathlib import Path<br>\nimport pyperclip<br>\nimport requests<br>\n<br>\nurl = 'https://api.imgur.com/3/image' # 备用 https://api.mashiro.top/imgur-api/3/image<br>\n<br>\n<br>\ndef upload(url1):<br>\n&nbsp; &nbsp; return requests.post(url, headers={'Authorization': 'Client-ID 98cd21cdfc58130'},<br>\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  data={'image': b64encode(open(url1, 'rb').read()), 'type': 'base64'}).text<br>\n<br>\n<br>\nPicDir = Path(r'C:\\1') # 本地图片存储目录<br>\na = []<br>\nfor sub in ['jpeg', 'png', 'gif', 'apng', 'jpg', 'tif', 'bmp']:<br>\n&nbsp; &nbsp; for file in PicDir.glob('**/*.' + sub):<br>\n&nbsp; &nbsp; &nbsp; &nbsp; a.append(file)<br>\n<br>\na.append(a[1]) # 搬运微博谈调换图片顺序<br>\ndel a[1]<br>\nb = ''<br>\nfor img in a:<br>\n&nbsp; &nbsp; print(img)<br>\n&nbsp; &nbsp; res = 'https://' + repr(re.findall(re.compile('i.imgur.com.*?(?=\"})'), upload(img))).replace('\\\\', '')[2:-2]<br>\n&nbsp; &nbsp; print(res)<br>\n&nbsp; &nbsp; b += '[img]' + res + '[/img]\\n'<br>\n&nbsp; &nbsp; time.sleep(0.5)<br>\nprint('\\n' + b)<br>\npyperclip.copy(b)</pre>","date":"2020-09-19","agreeCount":1,"discussionCount":0}